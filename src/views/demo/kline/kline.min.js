!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).kline={})}(this,t=>{function e(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];let e=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER;return t.forEach(t=>{e=Math.max(t.high,e),i=Math.min(t.low,i)}),{hn:e,ln:i}}function i(t,e){const i=Object.keys(t);if(Object.getOwnPropertySymbols){let a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(e=>Object.getOwnPropertyDescriptor(t,e).enumerable)),i.push.apply(i,a)}return i}function a(t){for(let a=1;arguments.length>a;a++){var e=null!=arguments[a]?arguments[a]:{};a%2?i(Object(e),!0).forEach(i=>{c(t,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):i(Object(e)).forEach(i=>{Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})}return t}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(let i=0;e.length>i;i++){const a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){const e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],()=>{})),!0}catch(t){return!1}}();return function(){let i;const a=l(t);if(e){const t=l(this).constructor;i=Reflect.construct(a,arguments,t)}else i=a.apply(this,arguments);return u(this,i)}}function p(t,e,i){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){const a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(a){const t=Object.getOwnPropertyDescriptor(a,e);return t.get?t.get.call(i):t.value}})(t,e,i||t)}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=Array(e);e>i;i++)a[i]=t[i];return a}function m(t,e){let i,a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return y(t,e);let i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?y(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);let e=0;const i=function(){};return{s:i,n:()=>t.length>e?{done:!1,value:t[e++]}:{done:!0},e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}let s=!0,n=!1;return{s(){a=a.call(t)},n(){const t=a.next();return s=t.done,t},e(t){n=!0,i=t},f(){try{s||null==a.return||a.return()}finally{if(n)throw i}}}}function v(t,e){if(k(t)&&k(e))for(const i in e)if(i in t){const a=t[i],s=e[i];k(s)&&k(a)&&!g(s)&&!g(a)?v(a,s):w(e[i])&&(t[i]=e[i])}}function x(t){if(!k(t))return t;let e;for(const i in e=g(t)?[]:{},t)if(t.hasOwnProperty(i)){const a=t[i];e[i]=k(a)?x(a):a}return e}function g(t){return"[object Array]"===Object.prototype.toString.call(t)}function f(t){return"function"==typeof t}function k(t){return!!t&&"object"===s(t)}function D(t){return"number"==typeof t&&!isNaN(t)}function w(t){return null!=t}function b(t){return"boolean"==typeof t}function P(t){return"string"==typeof t}function M(t){return t&&t instanceof HTMLElement&&t.appendChild&&"function"==typeof t.appendChild}function E(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(k(t)){const i=t[e];if(w(i))return i}return i}function C(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MM-DD hh:mm";if(D(e)){const a=t.format(new Date(e)),s=a.split(", "),n=s[0].split("/"),o={YYYY:n[2],MM:n[0],DD:n[1],"hh:mm":"24"===s[1].match(/^[\d]{2}/)[0]?s[1].replace(/^[\d]{2}/,"00"):s[1]};return i.replace(/YYYY|MM|DD|(hh:mm)/g,t=>o[t])}return"--"}function A(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&D(i)?i.toFixed(e):"".concat(i)}function T(t){return D(+t)?t>1e9?"".concat(+(t/1e9).toFixed(3),"B"):t>1e6?"".concat(+(t/1e6).toFixed(3),"M"):t>1e3?"".concat(+(t/1e3).toFixed(3),"K"):t:"--"}function I(t,e){return null==e&&(e=10),+(t=(+t).toFixed(e=Math.min(Math.max(0,e),20)))}function S(t){return Math.log(t)/Math.log(10)}function L(t){return Math.pow(10,t)}function O(t){const e=t.name,i=t.series,a=t.calcParams,s=t.plots,o=t.precision,r=t.calcParamsAllowDecimal,c=t.shouldCheckParamCount,l=t.shouldOhlc,d=t.shouldFormatBigNumber,u=t.baseValue,p=t.minValue,y=t.maxValue,m=t.styles,v=t.calcTechnicalIndicator,x=t.regeneratePlots,g=t.render;if(!e||!f(v))return null;const k=function(t){function v(){return n(this,v),x.call(this,{name:e,series:i,calcParams:a,plots:s,precision:o,calcParamsAllowDecimal:r,shouldCheckParamCount:c,shouldOhlc:l,shouldFormatBigNumber:d,baseValue:u,minValue:p,maxValue:y,styles:m})}h(v,t);const x=_(v);return v}(qt);return k.prototype.calcTechnicalIndicator=v,x&&f(x)&&(k.prototype.regeneratePlots=x),g&&f(g)&&(k.prototype.render=g),new k}function R(t){return{name:t.name,series:t.series,calcParams:t.calcParams,calcParamsAllowDecimal:t.calcParamsAllowDecimal,shouldCheckParamCount:t.shouldCheckParamCount,shouldOhlc:t.shouldOhlc,shouldFormatBigNumber:t.shouldFormatBigNumber,precision:t.precision,styles:t.styles,result:t.result||[]}}function F(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,i=e.calcParams,a=e.plots,s=e.precision,n=e.shouldFormatBigNumber,o=[];let r="",c="";return a.length>0&&(r=e.name),i.length>0&&(c="(".concat(i.join(","),")")),a.forEach(e=>{const i={};if(w(e.title)){let a=t[e.key];w(a)&&(a=A(a,s),n&&(a=T(a))),i.title=e.title,i.value=a}o.push(i)}),{values:o,name:r,calcParamText:c}}function z(t,e,i,a){t.fillStyle=e,t.beginPath(),t.arc(i.x,i.y,a,0,2*Math.PI),t.closePath(),t.fill()}function B(t,e,i){const a=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y),n=Math.abs(i.x-t.x);return Math.abs(a*Math.abs(i.y-t.y)-n*s)/2}function V(t,e,i){if(!i)return!1;const a=i.x-t.x,s=i.y-t.y;return!(a*a+s*s>e*e)}function H(t,e,i,a){t.beginPath();const s=t.lineWidth%2?.5:0;t.moveTo(i,e+s),t.lineTo(a,e+s),t.stroke(),t.closePath()}function Y(t,e,i,a){t.beginPath();const s=t.lineWidth%2?.5:0;t.moveTo(e+s,i),t.lineTo(e+s,a),t.stroke(),t.closePath()}function W(t,e){t.save(),t.lineWidth%2&&t.translate(.5,.5),e(),t.restore()}function N(t){const e=t.name,i=t.totalStep,a=t.checkMousePointOn,s=t.createGraphicDataSource,o=t.performMousePressedMove,r=t.performMouseMoveForDrawing,c=t.drawExtend;if(!(e&&D(i)&&f(a)&&f(s)))return null;const l=function(t){function a(t){const o=t.id,r=t.chartData,c=t.xAxis,h=t.yAxis,l=t.points,d=t.styles,u=t.lock;return n(this,a),s.call(this,{id:o,name:e,totalStep:i,chartData:r,xAxis:c,yAxis:h,points:l,styles:d,lock:u})}h(a,t);const s=_(a);return a}(ue);return l.prototype.checkMousePointOn=a,l.prototype.createGraphicDataSource=s,f(o)&&(l.prototype.performMousePressedMove=o),f(r)&&(l.prototype.performMouseMoveForDrawing=r),f(c)&&(l.prototype.drawExtend=c),l}function X(t){return{name:t.name(),id:t.id(),totalStep:t.totalStep(),lock:t.lock(),points:t.tpPoints(),styles:t.styles()}}function G(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||2}function j(t,e){return Math.round(t.measureText(e).width)}function Z(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Helvetica Neue";return"".concat(e," ").concat(t,"px ").concat(i)}function U(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout(t,20)}function K(t,e,i,a,s){t.fillStyle=e,t.fillText(s,i,a)}function q(t,e,i,a,s,n,o,r,c){J(t,e,s,n,o,r,c),$(t,i,a,s,n,o,r,c)}function $(t,e,i,a,s,n,o,r){t.lineWidth=i,t.strokeStyle=e,Q(t,a,s,n,o,r),t.stroke()}function J(t,e,i,a,s,n,o){t.fillStyle=e,Q(t,i,a,s,n,o),t.fill()}function Q(t,e,i,a,s,n){t.beginPath(),t.moveTo(e+n,i),t.arcTo(e+a,i,e+a,i+s,n),t.arcTo(e+a,i+s,e,i+s,n),t.arcTo(e,i+s,e,i,n),t.arcTo(e,i,e+a,i,n),t.closePath()}function tt(t){return t.getBoundingClientRect()||{left:0,top:0}}function et(t){return!!t.touches}function it(t){t.cancelable&&t.preventDefault()}function at(t,e){const i=t.clientX-e.clientX,a=t.clientY-e.clientY;return Math.sqrt(i*i+a*a)}function st(t){return t.type===Ue}function nt(t){return t.type===Ze}function ot(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;let i=0;return function(){const a=Date.now(),s=this,n=arguments;a-i>e&&(t.apply(s,n),i=a)}}const rt={name:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldCheckParamCount:!0,shouldOhlc:!0,plots:[{key:"bbi",title:"BBI: ",type:"line"}],calcTechnicalIndicator(t,e){const i=Math.max.apply(null,e),a=[],s=[];return t.map((n,o)=>{const r={},c=n.close;if(e.forEach((e,i)=>{a[i]=(a[i]||0)+c,e-1>o||(s[i]=a[i]/e,a[i]-=t[o-(e-1)].close)}),o>=i-1){let t=0;s.forEach(e=>{t+=e}),r.bbi=t/4}return r})}},ct={name:"DMA",calcParams:[10,50,10],plots:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calcTechnicalIndicator(t,e){const i=Math.max(e[0],e[1]);let a=0,s=0,n=0;const o=[];return t.forEach((r,c)=>{let h,l;const d={},u=r.close;if(a+=u,s+=u,e[0]-1>c||(h=a/e[0],a-=t[c-(e[0]-1)].close),e[1]-1>c||(l=s/e[1],s-=t[c-(e[1]-1)].close),c>=i-1){const t=h-l;d.dma=t,n+=t,i+e[2]-2>c||(d.ama=n/e[2],n-=o[c-(e[2]-1)].dma)}o.push(d)}),o}},ht={name:"DMI",calcParams:[14,6],plots:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calcTechnicalIndicator(t,e){let i=0,a=0,s=0,n=0,o=0,r=0,c=0,h=0;const l=[];return t.forEach((d,u)=>{const _={},p=t[u-1]||d,y=p.close,m=d.high,v=d.low,x=m-v,g=Math.abs(m-y),f=Math.abs(y-v),k=m-p.high,D=p.low-v,w=Math.max(Math.max(x,g),f),b=k>0&&k>D?k:0,P=D>0&&D>k?D:0;if(i+=w,a+=b,s+=P,u>=e[0]-1){u>e[0]-1?(n=n-n/e[0]+w,o=o-o/e[0]+b,r=r-r/e[0]+P):(n=i,o=a,r=s);let t=0,d=0;0!==n&&(t=100*o/n,d=100*r/n),_.pdi=t,_.mdi=d;let p=0;d+t!==0&&(p=Math.abs(d-t)/(d+t)*100),c+=p,2*e[0]-2>u||(_.adx=h=u>2*e[0]-2?(h*(e[0]-1)+p)/e[0]:c/e[0],2*e[0]+e[1]-3>u||(_.adxr=(l[u-(e[1]-1)].adx+h)/2))}l.push(_)}),l}},lt={name:"MACD",calcParams:[12,26,9],baseValue:0,plots:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",color(t,e){const i=(t.currentData.technicalIndicatorData||{}).macd;return i>0?e.bar.upColor:i<0?e.bar.downColor:e.bar.noChangeColor},isStroke:t=>(t.currentData.technicalIndicatorData||{}).macd>(t.preData.technicalIndicatorData||{}).macd}],calcTechnicalIndicator(t,e){let i,a,s=0,n=0,o=0,r=0;const c=Math.max(e[0],e[1]);return t.map((t,h)=>{const l={},d=t.close;return s+=d,e[0]-1>h||(i=h>e[0]-1?(2*d+(e[0]-1)*i)/(e[0]+1):s/e[0]),e[1]-1>h||(a=h>e[1]-1?(2*d+(e[1]-1)*a)/(e[1]+1):s/e[1]),c-1>h||(l.dif=n=i-a,o+=n,c+e[2]-2>h||(l.macd=2*(n-(r=h>c+e[2]-2?(2*n+r*(e[2]-1))/(e[2]+1):o/e[2])),l.dea=r)),l})}},dt={name:"CR",calcParams:[26,10,20,40,60],plots:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calcTechnicalIndicator(t,e){const i=Math.ceil(e[1]/2.5+1),a=Math.ceil(e[2]/2.5+1),s=Math.ceil(e[3]/2.5+1),n=Math.ceil(e[4]/2.5+1);let o=0;const r=[];let c=0;const h=[];let l=0;const d=[];let u=0;const _=[],p=[];return t.forEach((y,m)=>{const v={},x=t[m-1]||y,g=(x.high+x.close+x.low+x.open)/4,f=Math.max(0,y.high-g),k=Math.max(0,g-y.low);e[0]-1>m||(v.cr=0!==k?f/k*100:0,o+=v.cr,c+=v.cr,l+=v.cr,u+=v.cr,e[0]+e[1]-2>m||(r.push(o/e[1]),e[0]+e[1]+i-3>m||(v.ma1=r[r.length-1-i]),o-=p[m-(e[1]-1)].cr),e[0]+e[2]-2>m||(h.push(c/e[2]),e[0]+e[2]+a-3>m||(v.ma2=h[h.length-1-a]),c-=p[m-(e[2]-1)].cr),e[0]+e[3]-2>m||(d.push(l/e[3]),e[0]+e[3]+s-3>m||(v.ma3=d[d.length-1-s]),l-=p[m-(e[3]-1)].cr),e[0]+e[4]-2>m||(_.push(u/e[4]),e[0]+e[4]+n-3>m||(v.ma4=_[_.length-1-n]),u-=p[m-(e[4]-1)].cr)),p.push(v)}),p}},ut={name:"AO",calcParams:[5,34],shouldCheckParamCount:!0,plots:[{key:"ao",title:"AO: ",type:"bar",color:(t,e)=>(t.currentData.technicalIndicatorData||{}).ao>(t.preData.technicalIndicatorData||{}).ao?e.bar.upColor:e.bar.downColor,isStroke:t=>(t.currentData.technicalIndicatorData||{}).ao>(t.preData.technicalIndicatorData||{}).ao}],baseValue:0,calcTechnicalIndicator(t,e){const i=Math.max(e[0],e[1]);let a=0,s=0,n=0,o=0;return t.map((r,c)=>{const h={},l=(r.low+r.high)/2;if(a+=l,s+=l,c>=e[0]-1){n=a/e[0];const i=t[c-(e[0]-1)];a-=(i.low+i.high)/2}if(c>=e[1]-1){o=s/e[1];const i=t[c-(e[1]-1)];s-=(i.low+i.high)/2}return i-1>c||(h.ao=n-o),h})}},_t={name:"CCI",calcParams:[20],plots:[{key:"cci",title:"CCI: ",type:"line"}],calcTechnicalIndicator(t,e){const i=e[0]-1;let a=0;const s=[];return t.map((n,o)=>{const r={},c=(n.high+n.low+n.close)/3;if(a+=c,s.push(c),o>=i){const n=a/e[0],h=s.slice(o-i,o+1);let l=0;h.forEach(t=>{l+=Math.abs(t-n)});const d=l/e[0];r.cci=0!==d?(c-n)/d/.015:0,a-=(t[o-i].high+t[o-i].low+t[o-i].close)/3}return r})}},pt={name:"RSI",calcParams:[6,12,24],shouldCheckParamCount:!1,plots:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regeneratePlots:t=>t.map((t,e)=>{const i=e+1;return{key:"rsi".concat(i),title:"RSI".concat(i,": "),type:"line"}}),calcTechnicalIndicator(t,e,i){const a=[],s=[];return t.map((n,o)=>{const r={},c=n.close-(t[o-1]||n).close;return e.forEach((e,n)=>{if(c>0?a[n]=(a[n]||0)+c:s[n]=(s[n]||0)+Math.abs(c),o>=e-1){r[i[n].key]=0!==s[n]?100-100/(1+a[n]/s[n]):0;const c=t[o-(e-1)],h=c.close-(t[o-e]||c).close;h>0?a[n]-=h:s[n]-=Math.abs(h)}}),r})}},yt={name:"KDJ",calcParams:[9,3,3],plots:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calcTechnicalIndicator(t,i){const a=[];return t.forEach((s,n)=>{const o={},r=s.close;if(n>=i[0]-1){const s=e(t.slice(n-(i[0]-1),n+1)),c=s.ln,h=s.hn-c;o.k=((i[1]-1)*(a[n-1].k||50)+(r-c)/(0===h?1:h)*100)/i[1],o.d=((i[2]-1)*(a[n-1].d||50)+o.k)/i[2],o.j=3*o.k-2*o.d}a.push(o)}),a}},mt={name:"WR",calcParams:[6,10,14],shouldCheckParamCount:!1,plots:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regeneratePlots:t=>t.map((t,e)=>({key:"wr".concat(e+1),title:"WR".concat(e+1,": "),type:"line"})),calcTechnicalIndicator:(t,i,a)=>t.map((s,n)=>{const o={},r=s.close;return i.forEach((i,s)=>{const c=i-1;if(n>=c){const i=e(t.slice(n-c,n+1)),h=i.hn,l=h-i.ln;o[a[s].key]=0===l?0:(r-h)/l*100}}),o})},vt={name:"BOLL",series:"price",calcParams:[20,2],calcParamsAllowDecimal:{1:!0},precision:2,shouldOhlc:!0,plots:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calcTechnicalIndicator(t,e){const i=e[0]-1;let a=0;return t.map((s,n)=>{const o={};if(a+=s.close,n>=i){o.mid=a/e[0];const s=function(t,e){const i=t.length;let a=0;t.forEach(t=>{const i=t.close-e;a+=i*i});const s=a>0,n=Math.sqrt((a=Math.abs(a))/i);return s?n:-1*n}(t.slice(n-i,n+1),o.mid);o.up=o.mid+e[1]*s,o.dn=o.mid-e[1]*s,a-=t[n-i].close}return o})}},xt={name:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,plots:[{key:"sar",title:"SAR: ",type:"circle",color(t,e){const i=t.currentData,a=i.kLineData||{};return(a.high+a.low)/2>(i.technicalIndicatorData||{}).sar?e.circle.upColor:e.circle.downColor}}],calcTechnicalIndicator(t,e){const i=e[0]/100,a=e[1]/100,s=e[2]/100;let n=i,o=-100,r=!1,c=0;return t.map((e,h)=>{const l=c,d=e.high,u=e.low;if(r){(-100===o||d>o)&&(o=d,n=Math.min(n+a,s)),c=l+n*(o-l);const _=Math.min(t[Math.max(1,h)-1].low,u);c>e.low?(c=o,n=i,o=-100,r=!r):c>_&&(c=_)}else{(-100===o||o>u)&&(o=u,n=Math.min(n+a,s)),c=l+n*(o-l);const i=Math.max(t[Math.max(1,h)-1].high,d);e.high>c?(c=o,n=0,o=-100,r=!r):i>c&&(c=i)}return{sar:c}})}},gt={technicalIndicatorExtensions:{},graphicMarkExtensions:{},addTechnicalIndicator(t){const e=this;t&&[].concat(t).forEach(t=>{t.name&&(e.technicalIndicatorExtensions[t.name]=t)})},addGraphicMark(t){const e=this;t&&[].concat(t).forEach(t=>{t.name&&(e.graphicMarkExtensions[t.name]=t)})}},ft="dash",kt="left",Dt="right",wt="normal",bt="percentage",Pt="log",Mt="candle_solid",Et="candle_stroke",Ct="candle_up_stroke",At="candle_down_stroke",Tt="ohlc",It="area",St="always",Lt="follow_cross",Ot="rect",Rt="standard",Ft="circle",zt="rect",Bt="triangle",Vt="diamond",Ht="custom",Yt="point",Wt="top",Nt="bottom",Xt={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:ft,dashValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:ft,dashValue:[2,2]}},candle:{margin:{top:.2,bottom:.1},type:Mt,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#2196F3",value:"close",fillColor:[{offset:0,color:"rgba(33, 150, 243, 0.01)"},{offset:1,color:"rgba(33, 150, 243, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:ft,dashValue:[4,4],size:1},text:{show:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:St,showType:Rt,labels:["时间: ","开: ","收: ","高: ","低: ","成交量: "],values:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",fillColor:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},technicalIndicator:{margin:{top:.2,bottom:.1},bar:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},line:{size:1,colors:["#FF9600","#9D65C9","#2196F3","#E11D74","#01C5C4"]},circle:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},lastValueMark:{show:!1,text:{show:!1,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingTop:2,paddingRight:3,paddingBottom:2,borderRadius:2}},tooltip:{showRule:St,showType:Rt,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,height:null,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingTop:3,paddingBottom:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,width:null,type:wt,position:Dt,inside:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingRight:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:ft,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#686D76",borderRadius:2,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:ft,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderRadius:2,borderColor:"#686D76",backgroundColor:"#686D76"}}},graphicMark:{point:{backgroundColor:"#2196F3",borderColor:"rgba(33, 150, 243, 0.35)",borderSize:1,radius:5,activeBackgroundColor:"#2196F3",activeBorderColor:"rgba(33, 150, 243, 0.35)",activeBorderSize:3,activeRadius:5},line:{color:"#2196F3",size:1,dashValue:[2,2]},polygon:{stroke:{size:1,color:"#2196F3"},fill:{color:"rgba(33, 150, 243, 0.1)"}},arc:{stroke:{size:1,color:"#2196F3"},fill:{color:"rgba(33, 150, 243, 0.1)"}},text:{color:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",marginLeft:2,marginRight:2,marginTop:2,marginBottom:6}},annotation:{symbol:{type:Vt,position:Wt,size:8,color:"#2196F3",activeSize:10,activeColor:"#FF9600",offset:[0,20]}},tag:{position:Yt,offset:0,line:{show:!0,style:ft,dashValue:[4,2],size:1,color:"#2196F3"},text:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2},mark:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2}}},Gt="price",jt="volume",Zt="line",Ut="bar",Kt="circle",qt=function(){function t(e){const i=e.name,a=e.series,s=e.calcParams,o=e.plots,r=e.precision,c=e.calcParamsAllowDecimal,h=e.shouldCheckParamCount,l=e.shouldOhlc,d=e.shouldFormatBigNumber,u=e.baseValue,_=e.minValue,p=e.maxValue,y=e.styles;n(this,t),this.name=i||"",this.series=a||"normal",this.precision=D(r)&&r>=0?r:4,this.calcParams=g(s)?s:[],this.plots=g(o)?o:[],this.calcParamsAllowDecimal=k(c)?c:{},this.shouldCheckParamCount=!b(h)||h,this.shouldOhlc=l,this.shouldFormatBigNumber=d,this.baseValue=D(u)?u:null,this.minValue=_,this.maxValue=p,this.styles=y}return r(t,[{key:"setPrecision",value(t){return!(!D(t)||t<0||(this.precision=parseInt(t,10),0))}},{key:"setCalcParamsAllowDecimal",value(t){k(t)&&(this.calcParamsAllowDecimal=t)}},{key:"setCalcParams",value(t){if(!g(t))return!1;if(this.shouldCheckParamCount&&t.length!==this.calcParams.length)return!1;for(let e=0;t.length>e;e++){const i=t[e];if(!D(i)||i<=0||!this.calcParamsAllowDecimal[e]&&parseInt(i,10)!==i)return!1}this.calcParams=x(t);const e=this.regeneratePlots(t);return e&&g(e)&&(this.plots=e),!0}},{key:"setStyles",value(t,e){return!!k(t)&&(this.styles||(this.styles={bar:x(e.bar),line:x(e.line),circle:x(e.circle)}),v(this.styles,t),!0)}},{key:"calcTechnicalIndicator",value(t,e){}},{key:"regeneratePlots",value(t){}}]),t}(),$t=function(){function t(e){const i=e.id,a=e.chartData,s=e.xAxis,o=e.yAxis;n(this,t),this._id=i,this._chartData=a,this._xAxis=s,this._yAxis=o,this._styles=null}return r(t,[{key:"draw",value(t){}},{key:"setStyles",value(t,e){return!!k(t)&&(this._styles||(this._styles=x(e)),v(this._styles,t),!0)}},{key:"id",value(){return this._id}},{key:"styles",value(){return this._styles}},{key:"checkMousePointOnGraphic",value(t){}},{key:"onClick",value(t){}},{key:"onRightClick",value(t){}},{key:"onMouseEnter",value(t){}},{key:"onMouseLeave",value(t){}}]),t}(),Jt="other",Qt="point",te="none",ee="line",ie="text",ae="continuous_line",se="polygon",ne="arc",oe="stroke",re="fill",ce="dash",he=0,le=1,de=2,ue=function(t){function e(t){let a;const s=t.id,o=t.name,r=t.totalStep,c=t.chartData,h=t.xAxis,l=t.yAxis,d=t.points,u=t.styles,_=t.lock;return n(this,e),(a=i.call(this,{id:s,chartData:c,xAxis:h,yAxis:l}))._name=o,a._totalStep=r,a._lock=_,a._drawStep=1,a._points=[],a.setPoints(d),a.setStyles(u,c.styleOptions().graphicMark),a}h(e,t);const i=_(e);return r(e,[{key:"setPoints",value(t){if(g(t)&&t.length>0){let e;this._totalStep-1>t.length?(this._drawStep=t.length+1,this._points=x(t),e=t.length):(this._drawStep=-1,this._points=t.slice(0,this._totalStep-1),e=this._totalStep-1);for(let t=0;e>t;t++)this.performMouseMoveForDrawing(t+2,this.points,this._points[t],this._xAxis,this._yAxis);-1===this._drawStep&&this.performMousePressedMove(this._points,this._points.length-1,this._points[this._points.length-1],this._xAxis,this._yAxis)}}},{key:"_timestampOrDataIndexToPointX",value(t){const e=t.timestamp,i=t.dataIndex;return this._xAxis.convertToPixel(e?this._chartData.timestampToDataIndex(e):i)}},{key:"_drawLines",value(t,e,i,a){t.save(),t.strokeStyle=a.line.color,t.lineWidth=a.line.size,i===ce&&t.setLineDash(a.line.dashValue),e.forEach(e=>{let i,a;if(e.length>1)switch((i=e[0]).x===(a=e[1]).x?de:i.y===a.y?le:he){case he:W(t,()=>{t.beginPath(),t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke(),t.closePath()});break;case le:H(t,e[0].y,e[0].x,e[1].x);break;case de:Y(t,e[0].x,e[0].y,e[1].y)}}),t.restore()}},{key:"_drawContinuousLines",value(t,e,i,a){t.save(),t.strokeStyle=a.line.color,t.lineWidth=a.line.size,i===ce&&t.setLineDash(a.line.dashValue),e.forEach(e=>{e.length>0&&W(t,()=>{t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;e.length>i;i++)t.lineTo(e[i].x,e[i].y);t.stroke(),t.closePath()})}),t.restore()}},{key:"_drawPolygons",value(t,e,i,a){let s;t.save(),i===re?(t.fillStyle=a.polygon.fill.color,s=t.fill):(t.lineWidth=a.polygon.stroke.size,t.strokeStyle=a.polygon.stroke.color,s=t.stroke),e.forEach(e=>{e.length>0&&W(t,()=>{t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;e.length>i;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),s.call(t)})}),t.restore()}},{key:"_drawArcs",value(t,e,i,a){t.save(),i===re?t.fillStyle=a.arc.fill.color:(t.lineWidth=a.arc.stroke.size,t.strokeStyle=a.arc.stroke.color),e.forEach(e=>{const a=e.x,s=e.y,n=e.radius,o=e.startAngle,r=e.endAngle;t.beginPath(),t.arc(a,s,n,o,r),i===re?(t.closePath(),t.fill()):(t.stroke(),t.closePath())}),t.restore()}},{key:"_drawText",value(t,e,i,a){let s;t.save(),i===oe?(t.strokeStyle=a.text.color,s=t.strokeText):(t.fillStyle=a.text.color,s=t.fillText),t.font="".concat(a.text.weight," ").concat(a.text.size,"px ").concat(a.text.family),e.forEach(e=>{s.call(t,e.text,e.x+a.text.marginLeft,e.y-a.text.marginBottom)}),t.restore()}},{key:"draw",value(t){const e=this,i=this._points.map(t=>{const i=t.price;return{x:e._timestampOrDataIndexToPointX({timestamp:t.timestamp,dataIndex:t.dataIndex}),y:e._yAxis.convertToPixel(i)}}),a=this._styles||this._chartData.styleOptions().graphicMark;if(1!==this._drawStep&&i.length>0){const s={width:this._xAxis.width(),height:this._yAxis.height()},n={price:this._chartData.pricePrecision(),volume:this._chartData.volumePrecision()},o=this.createGraphicDataSource(this._drawStep,this._points,i,s,n,this._xAxis,this._yAxis)||[];o.forEach(i=>{const s=i.type,n=i.isDraw,o=i.style,r=i.dataSource,c=void 0===r?[]:r;if(!w(n)||n)switch(s){case ee:e._drawLines(t,c,o,a);break;case ae:e._drawContinuousLines(t,c,o,a);break;case se:e._drawPolygons(t,c,o,a);break;case ne:e._drawArcs(t,c,o,a);break;case ie:e._drawText(t,c,o,a)}}),this.drawExtend&&(t.save(),this.drawExtend(t,o,a,s,n,this._xAxis,this._yAxis),t.restore())}const s=this._chartData.graphicMarkMouseOperate();(s.hover.id===this._id&&s.hover.element!==te||s.click.id===this._id&&s.click.element!==te)&&i.forEach((i,n)=>{const o=i.x,r=i.y;let c=a.point.radius,h=a.point.backgroundColor,l=a.point.borderColor,d=a.point.borderSize;s.hover.id===e._id&&s.hover.element===Qt&&n===s.hover.elementIndex&&(c=a.point.activeRadius,h=a.point.activeBackgroundColor,l=a.point.activeBorderColor,d=a.point.activeBorderSize),z(t,l,{x:o,y:r},c+d),z(t,h,{x:o,y:r},c)})}},{key:"setLock",value(t){this._lock=t}},{key:"name",value(){return this._name}},{key:"lock",value(){return this._lock}},{key:"totalStep",value(){return this._totalStep}},{key:"points",value(){return this._points}},{key:"isDrawing",value(){return-1!==this._drawStep}},{key:"checkMousePointOnGraphic",value(t){for(var e=this._styles||this._chartData.styleOptions().graphicMark,i=[],a=0;this._points.length>a;a++){const s=this._points[a],n=s.price,o={x:this._timestampOrDataIndexToPointX({timestamp:s.timestamp,dataIndex:s.dataIndex}),y:this._yAxis.convertToPixel(n)};if(i.push(o),V(o,e.point.radius,t))return{id:this._id,element:Qt,elementIndex:a,instance:this}}let s;const n=m(this.createGraphicDataSource(this._drawStep,this._points,i,{width:this._xAxis.width(),height:this._yAxis.height()},{price:this._chartData.pricePrecision(),volume:this._chartData.volumePrecision()},this._xAxis,this._yAxis)||[]);try{for(n.s();!(s=n.n()).done;){const e=s.value,i=e.key,a=e.type,n=e.dataSource,o=void 0===n?[]:n;if(e.isCheck)for(let e=0;o.length>e;e++)if(this.checkMousePointOn(i,a,o[e],t))return{id:this._id,element:Jt,elementIndex:e,instance:this}}}catch(t){n.e(t)}finally{n.f()}}},{key:"mouseMoveForDrawing",value(t){const e=this._xAxis.convertFromPixel(t.x),i=this._chartData.dataIndexToTimestamp(e),a=this._yAxis.convertFromPixel(t.y);this._points[this._drawStep-1]={timestamp:i,price:a,dataIndex:e},this.performMouseMoveForDrawing(this._drawStep,this._points,{timestamp:i,price:a,dataIndex:e},this._xAxis,this._yAxis),this.onDrawing({id:this._id,step:this._drawStep,points:this._points})}},{key:"mouseLeftButtonDownForDrawing",value(){this._drawStep===this._totalStep-1?(this._drawStep=-1,this.onDrawEnd({id:this._id,points:this._points})):this._drawStep++}},{key:"mousePressedMove",value(t,e){const i=this._chartData.graphicMarkMouseOperate(),a=i.click.elementIndex;if(!this._lock&&i.click.id===this._id&&i.click.element===Qt&&-1!==a){const s=this._xAxis.convertFromPixel(t.x),n=this._chartData.dataIndexToTimestamp(s),o=this._yAxis.convertFromPixel(t.y);this._points[a].timestamp=n,this._points[a].dataIndex=s,this._points[a].price=o,this.performMousePressedMove(this._points,a,{dataIndex:s,timestamp:n,price:o},this._xAxis,this._yAxis),this.onPressedMove({id:i.click.id,points:this._points,event:e})}}},{key:"onDrawStart",value(t){}},{key:"onDrawing",value(t){}},{key:"onDrawEnd",value(t){}},{key:"onPressedMove",value(t){}},{key:"onRemove",value(t){}},{key:"checkMousePointOn",value(t,e,i,a){}},{key:"createGraphicDataSource",value(t,e,i,a,s,n,o){}},{key:"performMouseMoveForDrawing",value(t,e,i,a,s){}},{key:"performMousePressedMove",value(t,e,i,a,s){}}]),e}($t),_e=function(){function t(){n(this,t),this._observers=[]}return r(t,[{key:"subscribe",value(t){this._observers.indexOf(t)<0&&this._observers.push(t)}},{key:"unsubscribe",value(t){const e=this._observers.indexOf(t);e>-1?this._observers.splice(e,1):this._observers=[]}},{key:"execute",value(t){this._observers.forEach(e=>{e(t)})}},{key:"hasObservers",value(){return this._observers.length>0}}]),t}(),pe="technical_indicator_pane_",ye="graphic_mark_",me="candle_pane",ve=1,xe=2,ge=3,fe={DRAW_CANDLE:"drawCandle",DRAW_TECHNICAL_INDICATOR:"drawTechnicalIndicator",ZOOM:"zoom",SCROLL:"scroll",CROSSHAIR:"crosshair",PANE_DRAG:"pane_drag"},ke=function(){function t(e,i){n(this,t),this._handler=i,this._styleOptions=x(Xt),v(this._styleOptions,e),this._technicalIndicatorMapping=function(){const t={},e=gt.technicalIndicatorExtensions;for(const i in e){const a=O(e[i]);a&&(t[i]=a)}return t}(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._pricePrecision=2,this._volumePrecision=0,this._dateTimeFormat=new Intl.DateTimeFormat("en",{hour12:!1,year:"numeric",month:"2-digit",
day:"2-digit",hour:"2-digit",minute:"2-digit"}),this._dataList=[],this._visibleDataList=[],this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalDataSpace=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._offsetRightSpace=50,this._offsetRightBarCount=this._offsetRightSpace/this._dataSpace,this._leftMinVisibleBarCount=2,this._rightMinVisibleBarCount=2,this._from=0,this._to=0,this._crosshair={},this._preOffsetRightBarCount=0,this._dragGraphicMarkFlag=!1,this._graphicMarkMapping=function(){const t={},e=gt.graphicMarkExtensions;for(const i in e){const a=N(e[i]);a&&(t[i]=a)}return t}(),this._graphicMarkMouseOperate={click:{id:"",element:te,elementIndex:-1},hover:{id:"",element:te,elementIndex:-1}},this._graphicMarks=[],this._annotations=new Map,this._visibleAnnotations=[],this._annotationMouseOperate={id:""},this._tags=new Map,this._dragPaneFlag=!1,this._actionDelegate=new Map}return r(t,[{key:"_calcBarSpace",value(){return Math.max(1,Math.min(Math.floor(.8*this._dataSpace),Math.floor(this._dataSpace)-1))}},{key:"_adjustVisibleDataList",value(){const t=this._dataList.length;this._visibleDataList=[],this._visibleAnnotations=[];for(let i=this._from;this._to>i;i++){const a=this._dataList[i],s=this._totalDataSpace-(t+this._offsetRightBarCount-i-.5)*this._dataSpace;this._visibleDataList.push({index:i,x:s,data:a});const n=this._annotations.get(a.timestamp)||[];if(n.length>0){var e;const i=m(n);try{for(i.s();!(e=i.n()).done;){const t=e.value;t.createSymbolCoordinate(s),this._visibleAnnotations.push(t)}}catch(t){i.e(t)}finally{i.f()}}}}},{key:"_adjustFromTo",value(){const t=this._dataList.length,e=this._totalDataSpace/this._dataSpace,i=e-Math.min(this._leftMinVisibleBarCount,t);this._offsetRightBarCount>i&&(this._offsetRightBarCount=i);const a=-t+Math.min(this._rightMinVisibleBarCount,t);a>this._offsetRightBarCount&&(this._offsetRightBarCount=a),this._to=Math.round(this._offsetRightBarCount+t+.5),this._from=Math.round(this._to-e)-1,this._to>t&&(this._to=t),this._from<0&&(this._from=0),this._adjustVisibleDataList(),0===this._from&&this._more&&!this._loading&&this._loadMoreCallback&&f(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(E(this._dataList[0],"timestamp")))}},{key:"styleOptions",value(){return this._styleOptions}},{key:"applyStyleOptions",value(t){v(this._styleOptions,t)}},{key:"getTechnicalIndicatorInfo",value(t){if(!w(t)){const t={};for(const e in this._technicalIndicatorMapping)t[e]=R(this._technicalIndicatorMapping[e]);return t}const e=this.getTechnicalIndicatorInstance(t);return e?R(e):{}}},{key:"getTechnicalIndicatorInstance",value(t){return this._technicalIndicatorMapping[t]}},{key:"pricePrecision",value(){return this._pricePrecision}},{key:"volumePrecision",value(){return this._volumePrecision}},{key:"dateTimeFormat",value(){return this._dateTimeFormat}},{key:"setTimezone",value(t){let e;try{e=new Intl.DateTimeFormat("en",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){}e&&(this._dateTimeFormat=e)}},{key:"timezone",value(){return this._dateTimeFormat.resolvedOptions().timeZone}},{key:"setPriceVolumePrecision",value(t,e){for(const i in this._pricePrecision=t,this._volumePrecision=e,this._technicalIndicatorMapping)switch(this._technicalIndicatorMapping[i].series){case Gt:this._technicalIndicatorMapping[i].setPrecision(t);break;case jt:this._technicalIndicatorMapping[i].setPrecision(e)}}},{key:"dataList",value(){return this._dataList}},{key:"visibleDataList",value(){return this._visibleDataList}},{key:"clearDataList",value(){this._more=!0,this._loading=!0,this._dataList=[],this._visibleDataList=[],this._from=0,this._to=0}},{key:"addData",value(t,e,i){if(k(t)){if(g(t)){this._loading=!1,this._more=!b(i)||i;const e=0===this._dataList.length;this._dataList=t.concat(this._dataList),e&&this.setOffsetRightSpace(this._offsetRightSpace),this._adjustFromTo()}else this._dataList.length>e?(this._dataList[e]=t,this._adjustVisibleDataList()):(this._dataList.push(t),this._offsetRightBarCount<0&&(this._offsetRightBarCount-=1),this._adjustFromTo());this.setCrosshair(this._crosshair,!0)}}},{key:"dataSpace",value(){return this._dataSpace}},{key:"barSpace",value(){return this._barSpace}},{key:"setDataSpace",value(t,e){t<1||t>50||this._dataSpace===t||(this._dataSpace=t,this._barSpace=this._calcBarSpace(),e&&e(),this._adjustFromTo(),this.setCrosshair(this._crosshair,!0),this.invalidate())}},{key:"setTotalDataSpace",value(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this._adjustFromTo(),this.setCrosshair(this._crosshair,!0))}},{key:"setOffsetRightSpace",value(t,e){this._offsetRightSpace=t,this._offsetRightBarCount=t/this._dataSpace,e&&(this._adjustFromTo(),this.setCrosshair(this._crosshair,!0),this.invalidate())}},{key:"offsetRightSpace",value(){return this._offsetRightSpace}},{key:"offsetRightBarCount",value(){return this._offsetRightBarCount}},{key:"setLeftMinVisibleBarCount",value(t){this._leftMinVisibleBarCount=t}},{key:"setRightMinVisibleBarCount",value(t){this._rightMinVisibleBarCount=t}},{key:"from",value(){return this._from}},{key:"to",value(){return this._to}},{key:"crosshair",value(){return this._crosshair}},{key:"setCrosshair",value(t,e){let i,s;const n=t||{};s=w(n.x)?(i=this.coordinateToDataIndex(n.x))<0?0:i>this._dataList.length-1?this._dataList.length-1:i:i=this._dataList.length-1;const o=this._dataList[s],r=this.dataIndexToCoordinate(i),c=this._crosshair.x,h=this._crosshair.y,l=this._crosshair.paneId;this._crosshair=a(a({},n),{},{realX:r,kLineData:o,realDataIndex:i,dataIndex:s}),n.paneId&&o&&this._handler.crosshair({realDataIndex:i,dataIndex:s,kLineData:o,x:n.x,y:n.y}),c===n.x&&h===n.y&&l===n.paneId||e||this.invalidate(ve)}},{key:"startScroll",value(){this._preOffsetRightBarCount=this._offsetRightBarCount}},{key:"scroll",value(t,e){if(this._scrollEnabled){const i=t/this._dataSpace;this.actionExecute(fe.SCROLL,{barCount:i,distance:t}),this._offsetRightBarCount=this._preOffsetRightBarCount-i,this._adjustFromTo(),this.setCrosshair(e||this._crosshair,!0),this.invalidate()}}},{key:"coordinateToFloatIndex",value(t){return Math.round(1e6*(this._dataList.length+this._offsetRightBarCount-(this._totalDataSpace-t)/this._dataSpace))/1e6}},{key:"dataIndexToTimestamp",value(t){const e=this._dataList[t];if(e)return e.timestamp}},{key:"timestampToDataIndex",value(t){return 0===this._dataList.length?0:function(t,e,i){let a=0,s=0;for(s=t.length-1;a!==s;){const n=Math.floor((s+a)/2),o=s-a,r=t[n][e];if(i===t[a][e])return a;if(i===t[s][e])return s;if(i===r)return n;if(i>r?a=n:s=n,o<=2)break}return a}(this._dataList,"timestamp",t)}},{key:"dataIndexToCoordinate",value(t){return this._totalDataSpace-(this._dataList.length+this._offsetRightBarCount-t-.5)*this._dataSpace}},{key:"coordinateToDataIndex",value(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}},{key:"zoom",value(t,e){const i=this;if(this._zoomEnabled){e&&w(e.x)||(e={x:w(this._crosshair.x)?this._crosshair.x:this._totalDataSpace/2}),this.actionExecute(fe.ZOOM,{point:e,scale:t});const a=this.coordinateToFloatIndex(e.x);this.setDataSpace(this._dataSpace+t*(this._dataSpace/10),()=>{i._offsetRightBarCount+=a-i.coordinateToFloatIndex(e.x)})}}},{key:"invalidate",value(t){this._handler.invalidate(t)}},{key:"setZoomEnabled",value(t){this._zoomEnabled=t}},{key:"zoomEnabled",value(){return this._zoomEnabled}},{key:"setScrollEnabled",value(t){this._scrollEnabled=t}},{key:"scrollEnabled",value(){return this._scrollEnabled}},{key:"setLoadMoreCallback",value(t){this._loadMoreCallback=t}},{key:"addGraphicMarkInstance",value(t){if(this._graphicMarks.find(e=>e.id()===t.id()))return!1;const e=this._graphicMarks[this._graphicMarks.length-1];return e&&e.isDrawing()?this._graphicMarks[this._graphicMarks.length-1]=t:this._graphicMarks.push(t),this.invalidate(ve),!0}},{key:"addCustomGraphicMark",value(t){const e=this;t.forEach(t=>{const i=N(t);i&&(e._graphicMarkMapping[t.name]=i)})}},{key:"setGraphicMarkOptions",value(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.styles,a=e.lock,s=this._graphicMarks.find(e=>e.id()===t);s&&(s.setLock(a),s.setStyles(i,this._styleOptions.graphicMark)&&this.invalidate(ve))}},{key:"getGraphicMark",value(t){if(!t)return this._graphicMarks.map(t=>X(t));const e=this._graphicMarks.find(e=>e.id()===t);return e?X(e):null}},{key:"removeGraphicMarkInstance",value(t){const e=this._graphicMarks;if(w(t)){const i=e.findIndex(e=>e.id()===t);i>-1&&(e[i].onRemove({id:e[i].id()}),e.splice(i,1),this.invalidate(ve))}else e.length>0&&(e.forEach(t=>{t.onRemove({id:t.id()})}),this._graphicMarks=[],this.invalidate(ve))}},{key:"dragGraphicMarkFlag",value(){return this._dragGraphicMarkFlag}},{key:"setDragGraphicMarkFlag",value(t){this._dragGraphicMarkFlag=t}},{key:"graphicMarkMouseOperate",value(){return this._graphicMarkMouseOperate}},{key:"dragPaneFlag",value(){return this._dragPaneFlag}},{key:"setDragPaneFlag",value(t){this._dragPaneFlag=t}},{key:"graphicMarkMapping",value(){return this._graphicMarkMapping}},{key:"graphicMarks",value(){return this._graphicMarks}},{key:"visibleAnnotations",value(){return this._visibleAnnotations}},{key:"annotationMouseOperate",value(){return this._annotationMouseOperate}},{key:"addAnnotations",value(t){const e=this;t.forEach(t=>{e._annotations.has(t.id())?e._annotations.get(t.id()).push(t):e._annotations.set(t.id(),[t])}),this._adjustVisibleDataList(),this.invalidate(ve)}},{key:"removeAnnotation",value(t){const e=this;let i=!1;w(t)?([].concat(t).forEach(t=>{const a=t.timestamp;e._annotations.has(a)&&(i=!0,e._annotations.delete(a))}),i&&this._adjustVisibleDataList()):(i=!0,this._annotations.clear(),this._visibleAnnotations=[]),i&&this.invalidate(ve)}},{key:"tags",value(){return this._tags}},{key:"getTag",value(t){return this._tags.get(t)}},{key:"addTags",value(t){const e=this;t.forEach(t=>{e._tags.set(t.id(),t)}),this.invalidate(ve)}},{key:"removeTag",value(t){const e=this;let i=!1;w(t)?[].concat(t).forEach(t=>{e._tags.has(t)&&(i=!0,e._tags.delete(t))}):(i=!0,this._tags.clear()),i&&this.invalidate(ve)}},{key:"setOverlayMouseOperate",value(t,e){const i=this._graphicMarkMouseOperate,s=i.hover,n=i.click,o=this._annotationMouseOperate.id,r=this._graphicMarks[this._graphicMarks.length-1];let c=!1;!t.hover||s.id===t.hover.id&&s.element===t.hover.element&&s.elementIndex===t.hover.elementIndex||(this._graphicMarkMouseOperate.hover=a({},t.hover),c=!0),!t.click||n.id===t.click.id&&n.element===t.click.element&&n.elementIndex===t.click.elementIndex||(this._graphicMarkMouseOperate.click=a({},t.click),c=!0),e&&o!==e.id&&(this._annotationMouseOperate=a({},e),c=!0),(c||r&&r.isDrawing())&&this.invalidate(ve)}},{key:"addCustomTechnicalIndicator",value(t){const e=this;t.forEach(t=>{const i=O(t||{});i&&(e._technicalIndicatorMapping[i.name]=i)})}},{key:"actionExecute",value(t,e,i,a){this.hasAction(t)&&(i&&i(),this._actionDelegate.get(t).execute(e),a&&a())}},{key:"hasAction",value(t){return this._actionDelegate.has(t)&&this._actionDelegate.get(t).hasObservers()}},{key:"subscribeAction",value(t,e){return Object.values(fe).indexOf(t)>=0&&(this._actionDelegate.has(t)||this._actionDelegate.set(t,new _e),this._actionDelegate.get(t).subscribe(e),!0)}},{key:"unsubscribeAction",value(t,e){if(Object.values(fe).indexOf(t)<0)return!1;if(this._actionDelegate.has(t)){const i=this._actionDelegate.get(t);return i.unsubscribe(e),i.hasObservers()||this._actionDelegate.delete(t),!0}return!1}}]),t}(),De=function(){function t(e){n(this,t),this._height=-1,this._container=e.container,this._chartData=e.chartData,this._initBefore(e),this._initElement(),this._mainWidget=this._createMainWidget(this._element,e),this._yAxisWidget=this._createYAxisWidget(this._element,e)}return r(t,[{key:"_initBefore",value(t){}},{key:"_initElement",value(){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.position="relative",this._element.style.overflow="hidden",this._element.style.width="100%";const t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createMainWidget",value(t,e){}},{key:"_createYAxisWidget",value(t,e){}},{key:"width",value(){return this._element.offsetWidth}},{key:"setWidth",value(t,e){this._mainWidget.setWidth(t),this._yAxisWidget&&this._yAxisWidget.setWidth(e)}},{key:"height",value(){return this._height}},{key:"setHeight",value(t){this._height=t,this._mainWidget.setHeight(t),this._yAxisWidget&&this._yAxisWidget.setHeight(t)}},{key:"setOffsetLeft",value(t,e){this._mainWidget.setOffsetLeft(t),this._yAxisWidget&&this._yAxisWidget.setOffsetLeft(e)}},{key:"layout",value(){this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainWidget.layout(),this._yAxisWidget&&this._yAxisWidget.layout()}},{key:"invalidate",value(t){this._yAxisWidget&&this._yAxisWidget.invalidate(t),this._mainWidget.invalidate(t)}},{key:"getImage",value(t){const e=document.createElement("canvas"),i=e.getContext("2d"),a=G(e),s=this._element.offsetWidth,n=this._element.offsetHeight;e.style.width="".concat(s,"px"),e.style.height="".concat(n,"px"),e.width=s*a,e.height=n*a,i.scale(a,a);const o=this._mainWidget.getElement(),r=o.offsetWidth,c=o.offsetHeight,h=parseInt(o.style.left,10);if(i.drawImage(this._mainWidget.getImage(t),h,0,r,c),this._yAxisWidget){const e=this._yAxisWidget.getElement(),a=e.offsetWidth,s=e.offsetHeight,n=parseInt(e.style.left,10);i.drawImage(this._yAxisWidget.getImage(t),n,0,a,s)}return e}},{key:"destroy",value(){this._container.removeChild(this._element)}}]),t}(),we=function(){function t(e){n(this,t),this._width=0,this._height=0,this._initElement(e.container),this._mainView=this._createMainView(this._element,e),this._overlayView=this._createOverlayView(this._element,e)}return r(t,[{key:"_initElement",value(t){this._element=document.createElement("div"),this._element.style.top="0",this._element.style.margin="0",this._element.style.padding="0",this._element.style.position="absolute",this._element.style.overflow="hidden",t.appendChild(this._element)}},{key:"_createMainView",value(t,e){}},{key:"_createOverlayView",value(t,e){}},{key:"getElement",value(){return this._element}},{key:"setWidth",value(t){this._width=t,this._mainView.setWidth(t),this._overlayView.setWidth(t)}},{key:"setHeight",value(t){this._height=t,this._mainView.setHeight(t),this._overlayView.setHeight(t)}},{key:"setOffsetLeft",value(t){this._element.style.left="".concat(t,"px")}},{key:"layout",value(){this._element.offsetWidth!==this._width&&(this._element.style.width="".concat(this._width,"px")),this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainView.layout(),this._overlayView.layout()}},{key:"invalidate",value(t){switch(t){case ve:this._overlayView.flush();break;case xe:case ge:this._mainView.flush(),this._overlayView.flush()}}},{key:"getImage",value(t){const e=document.createElement("canvas"),i=e.getContext("2d"),a=G(e);return e.style.width="".concat(this._width,"px"),e.style.height="".concat(this._height,"px"),e.width=this._width*a,e.height=this._height*a,i.scale(a,a),i.drawImage(this._mainView.getImage(),0,0,this._width,this._height),t&&this._overlayView&&i.drawImage(this._overlayView.getImage(),0,0,this._width,this._height),e}}]),t}(),be=function(){function t(e,i){n(this,t),this._chartData=i,this._initCanvas(e)}return r(t,[{key:"_initCanvas",value(t){this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._canvas.style.zIndex="2",this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value(t){this._ctx.clearRect(0,0,this._canvas.offsetWidth,this._canvas.offsetHeight),t&&t(),this._draw()}},{key:"_draw",value(){}},{key:"setWidth",value(t){this._width=t}},{key:"setHeight",value(t){this._height=t}},{key:"layout",value(){const t=this;this._height!==this._canvas.offsetHeight||this._width!==this._canvas.offsetWidth?this._redraw(()=>{const e=G(t._canvas);t._canvas.style.width="".concat(t._width,"px"),t._canvas.style.height="".concat(t._height,"px"),t._canvas.width=Math.floor(t._width*e),t._canvas.height=Math.floor(t._height*e),t._ctx.scale(e,e)}):this.flush()}},{key:"flush",value(){let t;const e=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t),this.requestAnimationId=null),this.requestAnimationId=U(()=>{e._redraw()})}},{key:"getImage",value(){return this._canvas}}]),t}(),Pe=function(t){function e(t,a,s,o,r){let c;return n(this,e),(c=i.call(this,t,a))._xAxis=s,c._yAxis=o,c._additionalDataProvider=r,c}h(e,t);const i=_(e);return r(e,[{key:"_draw",value(){this._drawGrid(),this._drawTechnicalIndicators()}},{key:"_drawGrid",value(){const t=this,e=this._chartData.styleOptions().grid;if(e.show){const i=e.horizontal;this._ctx.save(),i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,this._ctx.setLineDash(i.style===ft?i.dashValue:[]),this._yAxis.ticks().forEach(e=>{H(t._ctx,e.y,0,t._width)}));const a=e.vertical;a.show&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,this._ctx.setLineDash(a.style===ft?a.dashValue:[]),this._xAxis.ticks().forEach(e=>{Y(t._ctx,e.x,0,t._height)})),this._ctx.restore()}}},{key:"_drawTechnicalIndicators",value(){const t=this,e=this._chartData.styleOptions().technicalIndicator;this._additionalDataProvider.technicalIndicators().forEach(i=>{const s=i.plots,n=[],o=t._chartData.dataList(),r=i.result,c=i.styles||e;i.render&&(t._ctx.save(),i.render(t._ctx,{from:t._chartData.from(),to:t._chartData.to(),kLineDataList:t._chartData.dataList(),technicalIndicatorDataList:r},{width:t._width,height:t._height,dataSpace:t._chartData.dataSpace(),barSpace:t._chartData.barSpace()},c,{convertFromPixel:t._xAxis.convertFromPixel.bind(t._xAxis),convertToPixel:t._xAxis.convertToPixel.bind(t._xAxis)},{convertFromPixel:t._yAxis.convertFromPixel.bind(t._yAxis),convertToPixel:t._yAxis.convertToPixel.bind(t._yAxis)},t._yAxis.isCandleYAxis()),t._ctx.restore());let h=i.baseValue;w(h)||(h=t._yAxis.min());const l=t._yAxis.convertToPixel(h),d=t._yAxis.isCandleYAxis();t._ctx.lineWidth=1,t._drawGraphics((e,h,u,_,p)=>{const y=r[h]||{};let m=0;i.shouldOhlc&&!d&&t._drawCandleBar(e,_,p,h,u,c.bar,Tt);const v={};s.forEach(s=>{const x=y[s.key],g=t._yAxis.convertToPixel(x);switch(v[s.key]=g,s.type){case Kt:if(w(x)){const i={preData:{kLineData:o[h-1],technicalIndicatorData:r[h-1]},currentData:{kLineData:u,technicalIndicatorData:y},nextData:{kLineData:o[h+1],technicalIndicatorData:r[h+1]}},a={x:e,y:g,radius:_,color:s.color&&s.color(i,c)||c.circle.noChangeColor,isStroke:!s.isStroke||s.isStroke(i)};t._drawCircle(a)}break;case Ut:if(w(x)){const i={preData:{kLineData:o[h-1],technicalIndicatorData:r[h-1]},currentData:{kLineData:u,technicalIndicatorData:y},nextData:{kLineData:o[h+1],technicalIndicatorData:r[h+1]}},a=Math.abs(l-g),n={x:e-_,width:2*_,height:Math.max(1,a)};n.y=g>l?l:a<1?l-1:g,n.color=s.color&&s.color(i,c)||c.bar.noChangeColor,n.isStroke=!!s.isStroke&&s.isStroke(i),t._drawBar(n)}break;case Zt:var f=null;w(x)&&(f={x:e,y:g}),n[m]?n[m].push(f):n[m]=[f],m++}t._drawActionExecute(fe.DRAW_TECHNICAL_INDICATOR,{ctx:t._ctx,kLineData:u,dataIndex:h,technicalIndicatorData:y,technicalIndicatorName:i.name,coordinate:a({x:e},v),viewport:{width:t._width,height:t._height},barSpace:p,halfBarSpace:_,isCandle:d})})},()=>{t._drawLines(n,c)})})}},{key:"_drawGraphics",value(t,e){const i=this._chartData.visibleDataList(),a=this._chartData.barSpace(),s=a/2;i.forEach((e,i)=>{t(e.x,e.index,e.data,s,a,i)}),e&&e()}},{key:"_drawLines",value(t,e){const i=this,a=e.line.colors||[],s=a.length;this._ctx.lineWidth=e.line.size,W(this._ctx,()=>{t.forEach((t,e)=>{i._ctx.strokeStyle=a[e%s],i._ctx.beginPath();let n=!0;t.forEach(t=>{w(t)&&(n?(i._ctx.moveTo(t.x,t.y),n=!1):i._ctx.lineTo(t.x,t.y))}),i._ctx.stroke(),i._ctx.closePath()})})}},{key:"_drawBar",value(t){t.isStroke?(this._ctx.strokeStyle=t.color,this._ctx.strokeRect(t.x+.5,t.y,t.width-1,t.height)):(this._ctx.fillStyle=t.color,this._ctx.fillRect(t.x,t.y,t.width,t.height))}},{key:"_drawCircle",value(t){this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.arc(t.x,t.y,t.radius,2*Math.PI,0,!0),t.isStroke?this._ctx.stroke():this._ctx.fill(),this._ctx.closePath()}},{key:"_drawCandleBar",value(t,e,i,a,s,n,o){const r=s.open,c=s.close,h=s.high,l=s.low;c>r?(this._ctx.strokeStyle=n.upColor,this._ctx.fillStyle=n.upColor):r>c?(this._ctx.strokeStyle=n.downColor,this._ctx.fillStyle=n.downColor):(this._ctx.strokeStyle=n.noChangeColor,this._ctx.fillStyle=n.noChangeColor);const d=this._yAxis.convertToPixel(r),u=this._yAxis.convertToPixel(c),_=this._yAxis.convertToPixel(h),p=this._yAxis.convertToPixel(l),y=Math.min(d,u),m=Math.max(d,u);this._ctx.fillRect(t-.5,_,1,y-_),this._ctx.fillRect(t-.5,m,1,p-m);const v=Math.max(1,m-y);switch(o){case Mt:this._ctx.fillRect(t-e,y,i,v);break;case Et:this._ctx.strokeRect(t-e+.5,y,i-1,v);break;case Ct:c>r?this._ctx.strokeRect(t-e+.5,y,i-1,v):this._ctx.fillRect(t-e,y,i,v);break;case At:c>r?this._ctx.fillRect(t-e,y,i,v):this._ctx.strokeRect(t-e+.5,y,i-1,v);break;default:this._ctx.fillRect(t-.5,_,1,p-_),this._ctx.fillRect(t-e,d-.5,e,1),this._ctx.fillRect(t,u-.5,e,1)}this._drawActionExecute(fe.DRAW_CANDLE,{ctx:this._ctx,dataIndex:a,kLineData:s,coordinate:{x:t,open:d,close:u,high:_,low:p},viewport:{width:this._width,height:this._height},barSpace:i,halfBarSpace:e,isCandle:this._yAxis.isCandleYAxis()})}},{key:"_drawActionExecute",value(t,e){const i=this;this._chartData.actionExecute(t,e,()=>{i._ctx.save()},()=>{i._ctx.restore()})}}]),e}(be),Me=function(t){function e(t,a,s,o,r){let c;return n(this,e),(c=i.call(this,t,a))._xAxis=s,c._yAxis=o,c._additionalDataProvider=r,c}h(e,t);const i=_(e);return r(e,[{key:"_draw",value(){this._drawCover();const t=this._chartData.crosshair();if(t.kLineData){const e=this._additionalDataProvider.technicalIndicators(),i=this._chartData.styleOptions().crosshair;t.paneId===this._additionalDataProvider.id()&&this._drawCrosshairLine(i,"horizontal",t.y,0,this._width,H),t.paneId&&this._drawCrosshairLine(i,"vertical",t.realX,0,this._height,Y),this._drawTooltip(t,e)}}},{key:"_drawCover",value(){}},{key:"_drawTooltip",value(t,e){const i=this._chartData.styleOptions().technicalIndicator;this._drawBatchTechnicalIndicatorToolTip(t,e,i,0,this._shouldDrawTooltip(t,i.tooltip))}},{key:"_drawCrosshairLine",value(t,e,i,a,s,n){const o=t[e],r=o.line;t.show&&o.show&&r.show&&(this._ctx.save(),this._ctx.lineWidth=r.size,this._ctx.strokeStyle=r.color,r.style===ft&&this._ctx.setLineDash(r.dashValue),n(this._ctx,i,a,s),this._ctx.restore())}},{key:"_drawBatchTechnicalIndicatorToolTip",value(t,e,i){const a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;if(n){const n=i.tooltip;let o=s;e.forEach(e=>{a._drawTechnicalIndicatorTooltip(t,e,i,o),o+=n.text.marginTop+n.text.size+n.text.marginBottom})}}},{key:"_drawTechnicalIndicatorTooltip",value(t,e,i){const a=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=i.tooltip,o=e.styles||i,r=e.result,c=r[t.dataIndex],h=F(c,e),l=o.line.colors,d=this._chartData.dataList(),u={preData:{kLineData:d[t.dataIndex-1],technicalIndicatorData:r[t.dataIndex-1]},currentData:{kLineData:d[t.dataIndex],technicalIndicatorData:c},nextData:{kLineData:d[t.dataIndex+1],technicalIndicatorData:r[t.dataIndex+1]}},_=e.plots,p=n.text,y=h.values,m=p.marginLeft,v=p.marginRight;let x=0;const g=p.marginTop+s,f=p.size,k=p.color,D=l.length;if(this._ctx.textBaseline="top",this._ctx.font=Z(f,p.weight,p.family),n.showName){const t=h.name,e=j(this._ctx,t);K(this._ctx,k,x+=m,g,t),x+=e,n.showParams||(x+=v)}if(n.showParams){const t=h.calcParamText,e=j(this._ctx,t);n.showName||(x+=m),K(this._ctx,k,x,g,t),x+=e+v}let b,P=0;_.forEach((t,e)=>{switch(t.type){case Kt:b=t.color&&t.color(u,o)||o.circle.noChangeColor;break;case Ut:b=t.color&&t.color(u,o)||o.bar.noChangeColor;break;case Zt:b=l[P%D]||k,P++}const i=y[e].title;if(w(i)){x+=m;const t="".concat(i).concat(y[e].value||n.defaultValue),s=j(a._ctx,t);K(a._ctx,b,x,g,t),x+=s+v}})}},{key:"_shouldDrawTooltip",value(t,e){const i=e.showRule;return i===St||i===Lt&&!!t.paneId}}]),e}(be),Ee=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_createMainView",value:(t,e)=>new Pe(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)},{key:"_createOverlayView",value:(t,e)=>new Me(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}]),e}(we),Ce=function(t){function e(t,a,s,o){let r;return n(this,e),(r=i.call(this,t,a))._yAxis=s,r._additionalDataProvider=o,r}h(e,t);const i=_(e);return r(e,[{key:"_draw",value(){const t=this._chartData.styleOptions().yAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t),this._drawTechnicalIndicatorLastValue(t),this._drawLastPriceLabel(t))}},{key:"_drawAxisLine",value(t){let e;const i=t.axisLine;i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,e=this._yAxis.isFromYAxisZero()?0:this._width-1,Y(this._ctx,e,0,this._height))}},{key:"_drawTickLines",value(t){const e=this,i=t.tickLine;if(i.show){let a,s;this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;const n=i.length;this._yAxis.isFromYAxisZero()?(a=0,t.axisLine.show&&(a+=t.axisLine.size),s=a+n):(a=this._width,t.axisLine.show&&(a-=t.axisLine.size),s=a-n),this._yAxis.ticks().forEach(t=>{H(e._ctx,t.y,a,s)})}}},{key:"_drawTickLabels",value(t){const e=this,i=t.tickText;if(i.show){let a;const s=t.tickLine,n=s.show,o=s.length;this._yAxis.isFromYAxisZero()?(a=i.paddingLeft,t.axisLine.show&&(a+=t.axisLine.size),n&&(a+=o),this._ctx.textAlign="left"):(a=this._width-i.paddingRight,t.axisLine.show&&(a-=t.axisLine.size),n&&(a-=o),this._ctx.textAlign="right"),this._ctx.textBaseline="middle",this._ctx.font=Z(i.size,i.weight,i.family),this._ctx.fillStyle=i.color,this._yAxis.ticks().forEach(t=>{e._ctx.fillText(t.v,a,t.y)}),this._ctx.textAlign="left"}}},{key:"_drawTechnicalIndicatorLastValue",value(t){const e=this,i=this._chartData.styleOptions().technicalIndicator,s=i.lastValueMark,n=this._additionalDataProvider.technicalIndicators();if(s.show&&s.text.show){const o=this._chartData.dataList();n.forEach(n=>{const r=n.result||[],c=r.length,h=r[c-1]||{},l={preData:{kLineData:o[c-2],technicalIndicatorData:r[c-2]},currentData:{kLineData:o[c-1],technicalIndicatorData:h},nextData:{kLineData:null,technicalIndicatorData:null}},d=n.precision,u=n.styles||i,_=u.line.colors||[],p=_.length;let y=0;n.plots.forEach(i=>{let o;const r=h[i.key];switch(i.type){case Kt:o=i.color&&i.color(l,u)||u.circle.noChangeColor;break;case Ut:o=i.color&&i.color(l,u)||u.bar.noChangeColor;break;case Zt:o=_[y%p],y++}w(r)&&e._drawMarkLabel(t,r,d,n.shouldFormatBigNumber,a(a({},s.text),{},{backgroundColor:o}))})})}}},{key:"_drawLastPriceLabel",value(t){if(this._yAxis.isCandleYAxis()){const e=this._chartData.styleOptions().candle.priceMark,i=e.last;if(e.show&&i.show&&i.text.show){const e=this._chartData.dataList(),s=e[e.length-1];if(s){let e;const n=s.close,o=s.open;e=n>o?i.upColor:o>n?i.downColor:i.noChangeColor,this._drawMarkLabel(t,n,this._chartData.pricePrecision(),!1,a(a({},i.text),{},{backgroundColor:e}))}}}}},{key:"_drawMarkLabel",value(t,e,i,a,s){let n;const o=s.size,r=s.weight,c=s.family,h=s.color,l=s.backgroundColor,d=s.borderRadius,u=s.paddingLeft,_=s.paddingTop,p=s.paddingRight,y=s.paddingBottom,m=this._yAxis.convertToNicePixel(e);if(this._yAxis.yAxisType()===bt){const t=((this._chartData.visibleDataList()[0]||{}).data||{}).close;n="".concat(((e-t)/t*100).toFixed(2),"%")}else n=A(e,i),a&&(n=T(n));let v;this._ctx.font=Z(o,r,c);const x=j(this._ctx,n)+u+p,g=_+o+y;v=this._yAxis.isFromYAxisZero()?0:this._width-x,J(this._ctx,l,v,m-_-o/2,x,g,d),this._ctx.textBaseline="middle",K(this._ctx,h,v+u,m,n)}}]),e}(be),Ae=function(t){function e(t,a,s,o){let r;return n(this,e),(r=i.call(this,t,a))._yAxis=s,r._additionalDataProvider=o,r}h(e,t);const i=_(e);return r(e,[{key:"_draw",value(){const t=this;this._ctx.textBaseline="middle",this._yAxis.isCandleYAxis()&&this._chartData.tags().forEach(e=>{e.drawText(t._ctx)}),this._drawCrossHairLabel()}},{key:"_drawCrossHairLabel",value(){const t=this._chartData.crosshair();if(t.paneId===this._additionalDataProvider.id()&&0!==this._chartData.dataList().length){const e=this._chartData.styleOptions().crosshair,i=e.horizontal,a=i.text;if(e.show&&i.show&&a.show){let e;const i=this._yAxis.convertFromPixel(t.y);if(this._yAxis.yAxisType()===bt){const t=(this._chartData.visibleDataList()[0]||{}).data||{};e="".concat(((i-t.close)/t.close*100).toFixed(2),"%")}else{const t=this._additionalDataProvider.technicalIndicators();let a=0,s=!1;this._yAxis.isCandleYAxis()?a=this._chartData.pricePrecision():t.forEach(t=>{a=Math.max(t.precision,a),s||(s=t.shouldFormatBigNumber)}),e=A(i,a),s&&(e=T(e))}const s=a.size;let n;this._ctx.font=Z(s,a.weight,a.family);const o=j(this._ctx,e),r=a.paddingLeft,c=a.paddingTop,h=a.borderSize,l=o+2*h+r+a.paddingRight,d=s+2*h+c+a.paddingBottom;n=this._yAxis.isFromYAxisZero()?0:this._width-l,q(this._ctx,a.backgroundColor,a.borderColor,h,n,t.y-h-c-s/2,l,d,a.borderRadius),K(this._ctx,a.color,n+h+r,t.y,e)}}}}]),e}(be),Te=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_createMainView",value:(t,e)=>new Ce(t,e.chartData,e.yAxis,e.additionalDataProvider)},{key:"_createOverlayView",value:(t,e)=>new Ae(t,e.chartData,e.yAxis,e.additionalDataProvider)}]),e}(we),Ie=function(){function t(e){n(this,t),this._chartData=e,this._width=0,this._height=0,this._cacheMinValue=0,this._cacheMaxValue=0,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[],this._initMeasureCanvas()}return r(t,[{key:"_initMeasureCanvas",value(){const t=document.createElement("canvas"),e=G(t);this._measureCtx=t.getContext("2d"),this._measureCtx.scale(e,e)}},{key:"min",value(){return this._minValue}},{key:"max",value(){return this._maxValue}},{key:"width",value(){return this._width}},{key:"height",value(){return this._height}},{key:"setWidth",value(t){this._width=t}},{key:"setHeight",value(t){this._height=t}},{key:"ticks",value(){return this._ticks}},{key:"computeAxis",value(t){const e=this._optimalMinMax(this._computeMinMax());return this._minValue=e.min,this._maxValue=e.max,this._range=e.range,!(this._cacheMinValue===e.min&&this._cacheMaxValue===e.max&&!t||(this._cacheMinValue=e.min,this._cacheMaxValue=e.max,this._ticks=this._optimalTicks(this._computeTicks()),0))}},{key:"_computeMinMax",value(){}},{key:"_optimalMinMax",value(t){}},{key:"_computeTicks",value(){const t=[];if(this._range>=0){const e=this._computeInterval(this._range),i=e.interval,a=e.precision,s=I(Math.ceil(this._minValue/i)*i,a),n=I(Math.floor(this._maxValue/i)*i,a);let o=0,r=s;if(0!==i)for(;n>=r;)t[o]={v:r.toFixed(a)},++o,r+=i}return t}},{key:"_optimalTicks",value(t){}},{key:"_computeInterval",value(t){let e,i,a,s;const n=(i=Math.floor(S(e=t/8)),a=L(i),e=((s=e/a)<1.5?1:s<2.5?2:s<3.5?3:s<4.5?4:s<5.5?5:s<6.5?6:8)*a,i<-20?e:+e.toFixed(i<0?-i:0));return{interval:n,precision:function(t){const e=`${t}`,i=e.indexOf("e");if(i>0){const t=+e.slice(i+1);return t<0?-t:0}const a=e.indexOf(".");return a<0?0:e.length-1-a}(n)}}}]),t}(),Se=function(t){function e(t,a,s){let o;return n(this,e),(o=i.call(this,t))._realRange=0,o._isCandleYAxis=a,o._additionalDataProvider=s,o}h(e,t);const i=_(e);return r(e,[{key:"_computeMinMax",value(){const t=this,e=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],i=[];let a=!1,s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;this._additionalDataProvider.technicalIndicators().forEach(t=>{a||(a=t.shouldOhlc),o=Math.min(o,t.precision),D(t.minValue)&&(s=Math.min(s,t.minValue)),D(t.maxValue)&&(n=Math.max(n,t.maxValue)),i.push({plots:t.plots,result:t.result})});let r=4
;if(this._isCandleYAxis){const t=this._chartData.pricePrecision();r=o!==Number.MAX_SAFE_INTEGER?Math.min(o,t):t}else o!==Number.MAX_SAFE_INTEGER&&(r=o);const c=this._chartData.visibleDataList(),h=this._chartData.styleOptions().candle,l=h.type===It,d=h.area.value,u=this._isCandleYAxis&&!l||!this._isCandleYAxis&&a;return c.forEach(a=>{const s=a.index,n=a.data;u&&(e[0]=Math.min(e[0],n.low),e[1]=Math.max(e[1],n.high)),t._isCandleYAxis&&l&&(e[0]=Math.min(e[0],n[d]),e[1]=Math.max(e[1],n[d])),i.forEach(t=>{const i=t.result[s]||{};t.plots.forEach(t=>{const a=i[t.key];w(a)&&(e[0]=Math.min(e[0],a),e[1]=Math.max(e[1],a))})})}),e[0]!==Number.MAX_SAFE_INTEGER&&e[1]!==Number.MIN_SAFE_INTEGER?(e[0]=Math.min(s,e[0]),e[1]=Math.max(n,e[1])):(e[0]=0,e[1]=10),{min:e[0],max:e[1],precision:r,specifyMin:s,specifyMax:n}}},{key:"_optimalMinMax",value(t){let e,i,a,s;const n=t.precision,o=t.specifyMin,r=t.specifyMax;let c=t.min,h=t.max;const l=this.yAxisType();switch(l){case bt:var d=(this._chartData.visibleDataList()[0]||{}).data||{};D(d.close)&&(c=(c-d.close)/d.close*100,h=(h-d.close)/d.close*100),e=.01;break;case Pt:c=S(c),h=S(h),e=.05*L(-n);break;default:e=L(-n)}if(c===h||e>Math.abs(c-h)){const t=o===c,i=r===h;c=t?c:i?c-8*e:c-4*e,h=i?h:t?h+8*e:h+4*e}a=(i=this._isCandleYAxis?this._chartData.styleOptions().candle.margin:this._chartData.styleOptions().technicalIndicator.margin).top>1?i.top/this._height:D(i.top)?i.top:.2,s=i.bottom>1?i.bottom/this._height:D(i.bottom)?i.bottom:.1;let u=Math.abs(h-c);return u=Math.abs((h+=u*a)-(c-=u*s)),this._realRange=l===Pt?Math.abs(L(h)-L(c)):u,{min:c,max:h,range:u}}},{key:"_optimalTicks",value(t){const e=this,i=[],a=this.yAxisType(),s=this._additionalDataProvider.technicalIndicators();let n,o,r=0,c=!1;this._isCandleYAxis?r=this._chartData.pricePrecision():s.forEach(t=>{r=Math.max(r,t.precision),c||(c=t.shouldFormatBigNumber)});const h=this._chartData.styleOptions().xAxis.tickText.size;return a===Pt&&(n=this._computeInterval(this._realRange)),t.forEach(t=>{let s;const l=t.v;let d=e._innerConvertToPixel(+l);switch(a){case bt:s="".concat(A(l,2),"%");break;case Pt:s=I(L(l),n.precision),d=e._innerConvertToPixel(S(s)),s=A(s,r);break;default:s=A(l,r),c&&(s=T(s))}d>h&&e._height-h>d&&(o&&o-d>2*h||!o)&&(i.push({v:s,y:d}),o=d)}),i}},{key:"_innerConvertToPixel",value(t){return Math.round((1-(t-this._minValue)/this._range)*this._height)}},{key:"isCandleYAxis",value(){return this._isCandleYAxis}},{key:"yAxisType",value(){return this._isCandleYAxis?this._chartData.styleOptions().yAxis.type:wt}},{key:"isFromYAxisZero",value(){const t=this._chartData.styleOptions().yAxis;return t.position===kt&&t.inside||t.position===Dt&&!t.inside}},{key:"getSelfWidth",value(){const t=this,e=this._chartData.styleOptions(),i=e.yAxis,a=i.width;if(D(a))return a;let s=0;if(i.show&&(i.axisLine.show&&(s+=i.axisLine.size),i.tickLine.show&&(s+=i.tickLine.length),i.tickText.show)){let e=0;this._measureCtx.font=Z(i.tickText.size,i.tickText.weight,i.tickText.family),this._ticks.forEach(i=>{e=Math.max(e,j(t._measureCtx,i.v))}),s+=i.tickText.paddingLeft+i.tickText.paddingRight+e}const n=e.crosshair;let o=0;if(n.show&&n.horizontal.show&&n.horizontal.text.show){const t=this._additionalDataProvider.technicalIndicators();let i=0,a=!1;t.forEach(t=>{i=Math.max(t.precision,i),a||(a=t.shouldFormatBigNumber)}),this._measureCtx.font=Z(n.horizontal.text.size,n.horizontal.text.weight,n.horizontal.text.family);let s=2;if(this.yAxisType()!==bt)if(this._isCandleYAxis){const t=this._chartData.pricePrecision(),a=e.technicalIndicator.lastValueMark;s=a.show&&a.text.show?Math.max(i,t):t}else s=i;let r=A(this._maxValue,s);a&&(r=T(r)),o+=n.horizontal.text.paddingLeft+n.horizontal.text.paddingRight+2*n.horizontal.text.borderSize+j(this._measureCtx,r)}return Math.max(s,o)}},{key:"convertFromPixel",value(t){const e=(1-t/this._height)*this._range+this._minValue;switch(this.yAxisType()){case bt:var i=(this._chartData.visibleDataList()[0]||{}).data||{};if(D(i.close))return i.close*e/100+i.close;break;case Pt:return L(e);default:return e}}},{key:"convertToPixel",value(t){let e;switch(this.yAxisType()){case bt:var i=(this._chartData.visibleDataList()[0]||{}).data||{};D(i.close)&&(e=(t-i.close)/i.close*100);break;case Pt:e=S(t);break;default:e=t}return this._innerConvertToPixel(e)}},{key:"convertToNicePixel",value(t){const e=this.convertToPixel(t);return Math.round(Math.max(.05*this._height,Math.min(e,.98*this._height)))}}]),e}(Ie),Le=function(t){function e(t){let a;return n(this,e),(a=i.call(this,t))._techs=new Map,"height"in t&&a.setHeight(t.height),a.setTechnicalIndicator(a._chartData.getTechnicalIndicatorInstance(t.name)),a}h(e,t);const i=_(e);return r(e,[{key:"_initBefore",value(t){this._id=t.id,this._yAxis=this._createYAxis(t)}},{key:"_createYAxis",value(t){return new Se(t.chartData,!1,{technicalIndicators:this.technicalIndicators.bind(this)})}},{key:"_createMainWidget",value(t,e){return new Ee({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicators:this.technicalIndicators.bind(this),id:this.id.bind(this)}})}},{key:"_createYAxisWidget",value(t,e){return new Te({container:t,chartData:e.chartData,yAxis:this._yAxis,additionalDataProvider:{technicalIndicators:this.technicalIndicators.bind(this),id:this.id.bind(this)}})}},{key:"setHeight",value(t){p(l(e.prototype),"setHeight",this).call(this,t),this._yAxis.setHeight(t)}},{key:"setWidth",value(t,i){p(l(e.prototype),"setWidth",this).call(this,t,i),this._yAxis.setWidth(i)}},{key:"id",value(){return this._id}},{key:"yAxis",value(){return this._yAxis}},{key:"technicalIndicators",value(){return this._techs}},{key:"isEmptyTechnicalIndicator",value(){return 0===this._techs.size}},{key:"removeTechnicalIndicator",value(t){return t?!!this._techs.has(t)&&(this._techs.delete(t),!0):(this._techs.clear(),!0)}},{key:"setTechnicalIndicator",value(t,e){if(t){if(this._techs.has(t.name))return!1;const i=Object.create(t);return e?this._techs.set(i.name,i):this._techs=new Map([[i.name,i]]),this.calcTechnicalIndicator(i),!0}return!1}},{key:"calcTechnicalIndicator",value(t){t.result=t.calcTechnicalIndicator(this._chartData.dataList(),t.calcParams,t.plots)||[]}},{key:"calcAllTechnicalIndicator",value(){const t=this;return this._techs.forEach(e=>{t.calcTechnicalIndicator(e)}),this._yAxis.computeAxis()}}]),e}(De),Oe=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_draw",value(){this._drawGrid();const t=this._chartData.styleOptions().candle;t.type===It?this._drawArea(t):(this._drawCandle(t),this._drawLowHighPrice(t.priceMark,"high","high",Number.MIN_SAFE_INTEGER,[-2,-5],(t,e)=>{if(t>e)return t}),this._drawLowHighPrice(t.priceMark,"low","low",Number.MAX_SAFE_INTEGER,[2,5],(t,e)=>{if(e>t)return t})),this._drawTechnicalIndicators(),this._drawLastPriceLine(t.priceMark)}},{key:"_drawArea",value(t){const e=this,i=[],a=[];let s=Number.MAX_SAFE_INTEGER;const n=t.area;this._drawGraphics((t,o,r,c,h,l)=>{const d=r[n.value];if(D(d)){const n=e._yAxis.convertToPixel(d);if(0===l){const s=t-c;a.push({x:s,y:e._height}),a.push({x:s,y:n}),i.push({x:s,y:n})}i.push({x:t,y:n}),a.push({x:t,y:n}),s=Math.min(s,n)}},()=>{const t=a.length;if(t>0){const s=a[t-1],n=e._chartData.barSpace()/2,o=s.x+n;i.push({x:o,y:s.y}),a.push({x:o,y:s.y}),a.push({x:o,y:e._height})}if(i.length>0&&(e._ctx.lineWidth=n.lineSize,e._ctx.strokeStyle=n.lineColor,W(e._ctx,()=>{e._ctx.beginPath(),e._ctx.moveTo(i[0].x,i[0].y);for(let t=1;i.length>t;t++)e._ctx.lineTo(i[t].x,i[t].y);e._ctx.stroke(),e._ctx.closePath()})),a.length>0){const i=n.fillColor;if(g(i)){const a=e._ctx.createLinearGradient(0,e._height,0,s);try{i.forEach(t=>{a.addColorStop(t.offset,t.color)})}catch(t){}e._ctx.fillStyle=a}else e._ctx.fillStyle=i;e._ctx.beginPath(),e._ctx.moveTo(a[0].x,a[0].y);for(let t=1;a.length>t;t++)e._ctx.lineTo(a[t].x,a[t].y);e._ctx.closePath(),e._ctx.fill()}})}},{key:"_drawCandle",value(t){const e=this;this._drawGraphics((i,a,s,n,o)=>{e._drawCandleBar(i,n,o,a,s,t.bar,t.type)})}},{key:"_drawLowHighPrice",value(t,e,i,a,s,n){const o=this,r=t[e];if(t.show&&r.show){const t=this._chartData.visibleDataList();let e=a,c=-1;t.forEach(t=>{const s=t.index,o=n(E(t.data,i,a),e);o&&(e=o,c=s)});const h=this._chartData.pricePrecision(),l=this._yAxis.convertToPixel(e),d=this._xAxis.convertToPixel(c),u=l+s[0];this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.strokeStyle=r.color,this._ctx.fillStyle=r.color,W(this._ctx,()=>{o._ctx.beginPath(),o._ctx.moveTo(d-2,u+s[0]),o._ctx.lineTo(d,u),o._ctx.lineTo(d+2,u+s[0]),o._ctx.stroke(),o._ctx.closePath()});const _=u+s[1];W(this._ctx,()=>{o._ctx.beginPath(),o._ctx.moveTo(d,u),o._ctx.lineTo(d,_),o._ctx.lineTo(d+5,_),o._ctx.stroke(),o._ctx.closePath()}),this._ctx.font=Z(r.textSize,r.textWeight,r.textFamily);const p=A(e,h);this._ctx.textBaseline="middle",this._ctx.fillText(p,d+5+r.textMargin,_)}}},{key:"_drawLastPriceLine",value(t){const e=t.last;if(t.show&&e.show&&e.line.show){const t=this._chartData.dataList(),i=t[t.length-1];if(i){let t;const a=i.close,s=i.open,n=this._yAxis.convertToNicePixel(a);t=a>s?e.upColor:s>a?e.downColor:e.noChangeColor,this._ctx.save(),this._ctx.strokeStyle=t,this._ctx.lineWidth=e.line.size,e.line.style===ft&&this._ctx.setLineDash(e.line.dashValue),H(this._ctx,n,0,this._width),this._ctx.restore()}}}}]),e}(Pe),Re=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_drawCover",value(){const t=this;this._ctx.textBaseline="alphabetic",this._chartData.tags().forEach(e=>{e.drawMarkLine(t._ctx)}),this._chartData.graphicMarks().forEach(e=>{e.draw(t._ctx)}),this._chartData.visibleAnnotations().forEach(e=>{e.draw(t._ctx)})}},{key:"_drawTooltip",value(t,e){const i=this._chartData.styleOptions(),a=i.candle,s=a.tooltip,n=i.technicalIndicator,o=n.tooltip,r=this._shouldDrawTooltip(t,s),c=this._shouldDrawTooltip(t,o);s.showType===Ot&&o.showType===Ot?this._drawCandleTooltipWithRect(t,e,a,r,n,c):s.showType===Rt?(this._drawCandleTooltipWithStandard(t.kLineData,a,r),o.showType===Rt?this._drawBatchTechnicalIndicatorToolTip(t,e,n,r?s.text.size+s.text.marginTop:0,c):this._drawCandleTooltipWithRect(t,e,a,!1,n,c)):(this._drawCandleTooltipWithRect(t,e,a,r,n,!1),this._drawBatchTechnicalIndicatorToolTip(t,e,n,0,c))}},{key:"_drawCandleTooltipWithStandard",value(t,e,i){const a=this;if(i){const i=this._getCandleTooltipData(t,e),s=e.tooltip,n=s.text.marginLeft,o=s.text.marginRight,r=s.text.size,c=s.text.color,h=s.labels;this._ctx.textBaseline="top",this._ctx.font=Z(r,s.text.weight,s.text.family);let l=n;const d=s.text.marginTop;h.forEach((t,e)=>{const r=j(a._ctx,t);let h,u;K(a._ctx,c,l,d,t),l+=r;const _=i[e]||s.defaultValue;k(_)?(h=_.value||s.defaultValue,u=_.color||c):(u=c,h=_);const p=j(a._ctx,h);K(a._ctx,u,l,d,h),l+=p+n+o})}}},{key:"_drawCandleTooltipWithRect",value(t,e,i,a,s,n){const o=this;if(a||n){const r=i.tooltip,c=r.labels,h=this._getCandleTooltipData(t.kLineData,i),l=r.text.marginLeft,d=r.text.marginRight,u=r.text.marginTop,_=r.text.marginBottom,p=r.text.size,y=r.text.color,m=r.rect,v=m.borderSize,x=m.paddingLeft,g=m.paddingRight,f=m.paddingTop,D=m.paddingBottom,b=m.offsetLeft,P=m.offsetRight;let M=0,E=0,C=0;this._ctx.save(),this._ctx.textBaseline="top",a&&(this._ctx.font=Z(p,r.text.weight,r.text.family),c.forEach((t,e)=>{let i;const a=h[e];i=k(a)?a.value||r.defaultValue:a;const s="".concat(t).concat(i),n=j(o._ctx,s)+l+d;M=Math.max(M,n)}),C+=(_+u+p)*c.length);const A=s.tooltip,T=A.text.marginLeft,I=A.text.marginRight,S=A.text.marginTop,L=A.text.marginBottom,O=A.text.size,R=[],z=this._chartData.dataList();if(e.forEach(e=>{const i=e.result;R.push({name:e.name,tooltipData:F(i[t.dataIndex],e),cbData:{preData:{kLineData:z[t.dataIndex-1],technicalIndicatorData:i[t.dataIndex-1]},currentData:{kLineData:z[t.dataIndex],technicalIndicatorData:i[t.dataIndex]},nextData:{kLineData:z[t.dataIndex+1],technicalIndicatorData:i[t.dataIndex+1]}}})}),n&&(this._ctx.font=Z(O,A.text.weight,A.text.family),R.forEach(t=>{t.tooltipData.values.forEach(t=>{const e=t.title,i=t.value;if(w(e)){const t=i||A.defaultValue,a="".concat(e).concat(t),s=j(o._ctx,a)+T+I;M=Math.max(M,s),C+=S+L+O}})})),0!==(E+=M)&&0!==C){let i;E+=2*v+x+g;const s=m.offsetTop,M=m.borderRadius;J(this._ctx,m.fillColor,i=this._width/2>t.realX?this._width-P-E:b,s,E,C+=2*v+f+D,M),$(this._ctx,m.borderColor,v,i,s,E,C,M);const F=i+v+x+l;let z=s+v+f;if(a&&(this._ctx.font=Z(p,r.text.weight,r.text.family),c.forEach((t,e)=>{let a,s;z+=u,o._ctx.textAlign="left",K(o._ctx,y,F,z,t);const n=h[e];k(n)?(s=n.color||y,a=n.value||r.defaultValue):(s=y,a=n||r.defaultValue),o._ctx.textAlign="right",K(o._ctx,s,i+E-v-d-g,z,a),z+=p+_})),n){const t=this._chartData.styleOptions().technicalIndicator,a=i+v+x+T;this._ctx.font=Z(O,A.text.weight,A.text.family),R.forEach(s=>{let n;const r=s.tooltipData,c=s.cbData,h=e.get(s.name),l=h.styles||t,d=l.line.colors,u=d.length;let _=0;h.plots.forEach((t,e)=>{switch(t.type){case Kt:n=t.color&&t.color(c,l)||l.circle.noChangeColor;break;case Ut:n=t.color&&t.color(c,l)||l.bar.noChangeColor;break;case Zt:n=d[_%u]||l.text.color,_++}const s=r.values[e];w(s.title)&&(z+=S,o._ctx.textAlign="left",o._ctx.fillStyle=n,o._ctx.fillText("".concat(s.title),a,z),o._ctx.textAlign="right",o._ctx.fillText(s.value||A.defaultValue,i+E-v-I-g,z),z+=O+L)})})}this._ctx.restore()}}}},{key:"_getCandleTooltipData",value(t,e){const i=this,a=e.tooltip.values;let s=[];if(a)f(a)?s=a(t,e)||[]:g(a)&&(s=a);else{const e=this._chartData.pricePrecision(),a=this._chartData.volumePrecision();(s=[E(t,"timestamp"),E(t,"open"),E(t,"close"),E(t,"high"),E(t,"low"),E(t,"volume")]).forEach((t,n)=>{switch(n){case 0:s[n]=C(i._chartData.dateTimeFormat(),t,"YYYY-MM-DD hh:mm");break;case s.length-1:s[n]=T(A(t,a));break;default:s[n]=A(t,e)}})}return s}}]),e}(Me),Fe=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_createMainView",value:(t,e)=>new Oe(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)},{key:"_createOverlayView",value:(t,e)=>new Re(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}]),e}(Ee),ze=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_createYAxis",value(t){return new Se(t.chartData,!0,{technicalIndicators:this.technicalIndicators.bind(this)})}},{key:"_createMainWidget",value(t,e){return new Fe({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicators:this.technicalIndicators.bind(this),id:this.id.bind(this)}})}}]),e}(Le),Be=function(t){function e(t,a,s){let o;return n(this,e),(o=i.call(this,t,a))._xAxis=s,o}h(e,t);const i=_(e);return r(e,[{key:"_draw",value(){const t=this._chartData.styleOptions().xAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t))}},{key:"_drawAxisLine",value(t){const e=t.axisLine;e.show&&(this._ctx.strokeStyle=e.color,this._ctx.lineWidth=e.size,H(this._ctx,0,0,this._width))}},{key:"_drawTickLines",value(t){const e=this,i=t.tickLine;if(i.show){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;const a=t.axisLine.show?t.axisLine.size:0,s=a+i.length;this._xAxis.ticks().forEach(t=>{Y(e._ctx,t.x,a,s)})}}},{key:"_drawTickLabels",value(t){const e=t.tickText;if(e.show){const i=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=Z(e.size,e.weight,e.family),this._ctx.textAlign="center",this._ctx.fillStyle=e.color;let a=e.paddingTop;t.axisLine.show&&(a+=t.axisLine.size),i.show&&(a+=i.length);for(let t=this._xAxis.ticks(),e=t.length,i=0;e>i;i++)this._ctx.fillText(t[i].v,t[i].x,a)}}}]),e}(be),Ve=function(t){function e(t,a,s){let o;return n(this,e),(o=i.call(this,t,a))._xAxis=s,o}h(e,t);const i=_(e);return r(e,[{key:"_draw",value(){this._drawCrosshairLabel()}},{key:"_drawCrosshairLabel",value(){const t=this._chartData.crosshair();if(t.paneId){const e=this._chartData.styleOptions().crosshair,i=e.vertical,a=i.text;if(e.show&&i.show&&a.show&&t.dataIndex===t.realDataIndex){const e=t.realX,i=t.kLineData.timestamp,s=C(this._chartData.dateTimeFormat(),i,"YYYY-MM-DD hh:mm"),n=a.size;this._ctx.font=Z(n,a.weight,a.family);const o=j(this._ctx,s);let r=e-o/2;const c=a.paddingLeft,h=a.paddingRight,l=a.paddingTop,d=a.borderSize;c+d>r?r=c+d:r>this._width-o-d-h&&(r=this._width-o-d-h),q(this._ctx,a.backgroundColor,a.borderColor,d,r-d-c,0,o+2*d+h+c,n+2*d+l+a.paddingBottom,a.borderRadius),this._ctx.textBaseline="top",K(this._ctx,a.color,r,d+l,s)}}}}]),e}(be),He=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_createMainView",value:(t,e)=>new Be(t,e.chartData,e.xAxis)},{key:"_createOverlayView",value:(t,e)=>new Ve(t,e.chartData,e.xAxis)}]),e}(we),Ye=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_computeMinMax",value(){return{min:this._chartData.from(),max:this._chartData.to()-1}}},{key:"_optimalMinMax",value(t){const e=t.min,i=t.max;return{min:e,max:i,range:i-e+1}}},{key:"_optimalTicks",value(t){const e=[],i=t.length,a=this._chartData.dataList();if(i>0){const s=this._chartData.dateTimeFormat(),n=this._chartData.styleOptions().xAxis.tickText;this._measureCtx.font=Z(n.size,n.weight,n.family);const o=j(this._measureCtx,"00-00 00:00"),r=this.convertToPixel(parseInt(t[0].v,10));let c=1;if(i>1){const e=this.convertToPixel(parseInt(t[1].v,10)),i=Math.abs(e-r);o>i&&(c=Math.ceil(o/i))}for(let n=0;i>n;n+=c){const i=parseInt(t[n].v,10),o=a[i].timestamp;let r=C(s,o,"hh:mm");0!==n&&(r=this._optimalTickLabel(s,o,a[parseInt(t[n-c].v,10)].timestamp)||r);const h=this.convertToPixel(i);e.push({v:r,x:h,oV:o})}if(1===e.length)e[0].v=C(s,e[0].oV,"YYYY-MM-DD hh:mm");else{const t=e[0].oV,i=e[1].oV;if(e[2]){const i=e[2].v;/^[0-9]{2}-[0-9]{2}$/.test(i)?e[0].v=C(s,t,"MM-DD"):/^[0-9]{4}-[0-9]{2}$/.test(i)?e[0].v=C(s,t,"YYYY-MM"):/^[0-9]{4}$/.test(i)&&(e[0].v=C(s,t,"YYYY"))}else e[0].v=this._optimalTickLabel(s,t,i)||e[0].v}}return e}},{key:"_optimalTickLabel",value(t,e,i){const a=C(t,e,"YYYY"),s=C(t,e,"YYYY-MM"),n=C(t,e,"MM-DD");return a!==C(t,i,"YYYY")?a:s!==C(t,i,"YYYY-MM")?s:n!==C(t,i,"MM-DD")?n:null}},{key:"getSelfHeight",value(){const t=this._chartData.styleOptions(),e=t.xAxis,i=e.height;if(D(i))return i;const a=t.crosshair;let s=0;e.show&&(e.axisLine.show&&(s+=e.axisLine.size),e.tickLine.show&&(s+=e.tickLine.length),e.tickText.show&&(s+=e.tickText.paddingTop+e.tickText.paddingBottom+e.tickText.size));let n=0;return a.show&&a.vertical.show&&a.vertical.text.show&&(n+=a.vertical.text.paddingTop+a.vertical.text.paddingBottom+2*a.vertical.text.borderSize+a.vertical.text.size),Math.max(s,n)}},{key:"convertFromPixel",value(t){return this._chartData.coordinateToDataIndex(t)}},{key:"convertToPixel",value(t){return this._chartData.dataIndexToCoordinate(t)}}]),e}(Ie),We=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"_initBefore",value(){this._xAxis=new Ye(this._chartData)}},{key:"_createMainWidget",value(t,e){return new He({container:t,chartData:e.chartData,xAxis:this._xAxis})}},{key:"xAxis",value(){return this._xAxis}},{key:"setWidth",value(t,i){p(l(e.prototype),"setWidth",this).call(this,t,i),this._xAxis.setWidth(t)}},{key:"setHeight",value(t){p(l(e.prototype),"setHeight",this).call(this,t),this._xAxis.setHeight(t)}}]),e}(De),Ne=0,Xe=2,Ge=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),je="onorientationchange"in window&&Ge,Ze="mouse",Ue="touch",Ke=function(){function t(e,i,a){n(this,t),this._target=e,this._handler=i,this._options=a,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return r(t,[{key:"destroy",value(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value(t){const e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();const i=this._mouseMoveHandler.bind(this),a=this._mouseWheelHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i),e._target.removeEventListener("wheel",a)},this._target.addEventListener("mousemove",i),this._target.addEventListener("wheel",a,{passive:!1}),et(t)&&this._mouseMoveHandler(t);const s=this._makeCompatEvent(t);this._processEvent(s,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value(t){if(!this._mousePressed||et(t)){const e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseWheelHandler",value(t){const e=this._makeCompatEvent(t);t.localX=e.localX,t.localY=e.localY,this._processEvent(t,this._handler.mouseWheelEvent)}},{key:"_mouseMoveWithDownHandler",value(t){if(!("button"in t&&t.button!==Ne||null!==this._startPinchMiddlePoint)){const e=et(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;const i=this._makeCompatEvent(t),a=this._mouseMoveStartPosition,s=Math.abs(a.x-i.pageX),n=Math.abs(a.y-i.pageY),o=s+n>5;if(o||!e){if(o&&!this._moveExceededManhattanDistance&&e){const t=.5*s;n>=t&&!this._options.treatVertTouchDragAsPageScroll||t>n&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}o&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&it(t))}}}}},{key:"_mouseUpHandler",value(t){if(!("button"in t)||t.button===Ne){const e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),et(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),et(t)&&(it(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value(t){if(!("button"in t)||t.button===Ne||t.button===Xe){const e=this._makeCompatEvent(t);if("button"in t&&t.button===Xe)this._processEvent(e,this._handler.mouseRightDownEvent);else{this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,et(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);const i=this._mouseMoveWithDownHandler.bind(this),a=this._mouseUpHandler.bind(this),s=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){s.removeEventListener("touchmove",i),s.removeEventListener("touchend",a),s.removeEventListener("mousemove",i),s.removeEventListener("mouseup",a)},s.addEventListener("touchmove",i,{passive:!1}),s.addEventListener("touchend",a,{passive:!1}),this._clearLongTapTimeout(),et(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(s.addEventListener("mousemove",i),s.addEventListener("mouseup",a)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}}},{key:"_init",value(){const t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));const e=this._target.ownerDocument,i=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",i),e.removeEventListener("touchstart",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",i,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),je||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}},{key:"_initPinch",value(){const t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",e=>t._checkPinchState(e.touches),{passive:!0}),this._target.addEventListener("touchmove",e=>{if(2===e.touches.length&&null!==t._startPinchMiddlePoint&&void 0!==t._handler.pinchEvent){const i=at(e.touches[0],e.touches[1]);t._handler.pinchEvent(t._startPinchMiddlePoint,i/t._startPinchDistance),it(e)}},{passive:!1}),this._target.addEventListener("touchend",e=>{t._checkPinchState(e.touches)}))}},{key:"_checkPinchState",value(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value(t){const e=tt(this._target);this._startPinchMiddlePoint={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=at(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();const e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value(t){const e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value(t){let e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;const i=tt(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?Ze:Ue,target:e.target,view:t.view}}}]),t}(),qe=function(){function t(e,i,a,s,o,r){n(this,t),this._chartData=i,this._topPaneId=a,this._bottomPaneId=s,this._dragEnabled=o,this._width=0,this._offsetLeft=0,this._dragEventHandler=r,this._dragFlag=!1,this._initElement(e),this._initEvent(o)}return r(t,[{key:"_initElement",value(t){this._container=t,this._wrapper=this._createElement(),this._wrapper.style.position="relative",this._element=this._createElement(),this._element.style.width="100%",this._element.style.position="absolute",this._element.style.zIndex="20",this._element.style.top="-3px",this._element.style.height="7px",this._wrapper.appendChild(this._element);const e=t.lastChild;e?t.insertBefore(this._wrapper,e):t.appendChild(this._wrapper)}},{key:"_initEvent",value(t){t&&(this._element.style.cursor="ns-resize",this._dragEvent=new Ke(this._element,{mouseDownEvent:this._mouseDownEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0}))}},{key:"_createElement",value(){const t=document.createElement("div");return t.style.margin="0",t.style.padding="0",t}},{key:"_mouseDownEvent",value(t){this._dragFlag=!0,this._startY=t.pageY,this._dragEventHandler.startDrag(this._topPaneId,this._bottomPaneId)}},{key:"_mouseUpEvent",value(){this._dragFlag=!1,this._chartData.setDragPaneFlag(!1)}},{key:"_pressedMouseMoveEvent",value(t){this._dragEventHandler.drag(t.pageY-this._startY,this._topPaneId,this._bottomPaneId),this._chartData.setDragPaneFlag(!0),this._chartData.setCrosshair()}},{key:"_mouseEnterEvent",value(){const t=this._chartData.styleOptions().separator;this._element.style.background=t.activeBackgroundColor,this._chartData.setDragPaneFlag(!0),this._chartData.setCrosshair()}},{key:"_mouseLeaveEvent",value(){this._dragFlag||(this._element.style.background=null,this._chartData.setDragPaneFlag(!1))}},{key:"height",value(){return this._wrapper.offsetHeight}},{key:"setSize",value(t,e){this._offsetLeft=t,this._width=e,this.invalidate()}},{key:"setDragEnabled",value(t){t!==this._dragEnabled&&(this._dragEnabled=t,t?!this._dragEvent&&this._initEvent(t):(this._element.style.cursor="default",this._dragEvent&&this._dragEvent.destroy(),this._dragEvent=null))}},{key:"topPaneId",value(){return this._topPaneId}},{key:"bottomPaneId",value(){return this._bottomPaneId}},{key:"updatePaneId",value(t,e){w(t)&&(this._topPaneId=t),w(e)&&(this._bottomPaneId=e)}},{key:"invalidate",value(){const t=this._chartData.styleOptions().separator;this._element.style.top="".concat(-Math.floor((7-t.size)/2),"px"),this._wrapper.style.backgroundColor=t.color,this._wrapper.style.height="".concat(t.size,"px"),this._wrapper.style.marginLeft="".concat(t.fill?0:this._offsetLeft,"px"),this._wrapper.style.width=t.fill?"100%":"".concat(this._width,"px")}},{key:"getImage",value(){const t=this._chartData.styleOptions().separator,e=document.createElement("canvas"),i=e.getContext("2d"),a=G(e),s=this._wrapper.offsetWidth,n=t.size;return e.style.width="".concat(s,"px"),e.style.height="".concat(n,"px"),e.width=s*a,e.height=n*a,i.scale(a,a),i.fillStyle=t.color,i.fillRect(this._offsetLeft,0,s,n),e}},{key:"destroy",value(){this._dragEvent&&this._dragEvent.destroy(),this._container.removeChild(this._wrapper)}}]),t}(),$e=function(){function t(e){n(this,t),this._chartData=e,this._chartContentSize={},this._paneContentSize={}}return r(t,[{key:"_checkEventPointX",value(t){return t>0&&this._chartContentSize.contentRight-this._chartContentSize.contentLeft>t}},{key:"setChartContentSize",value(t){this._chartContentSize=t}},{key:"setPaneContentSize",value(t){this._paneContentSize=t}}]),t}(),Je=function(t){function e(t){let a;return n(this,e),(a=i.call(this,t))._startScrollPoint={},a._touchPoint=null,a._touchCancelCrossHair=!1,a._touchZoomed=!1,a._pinchScale=1,a}h(e,t);const i=_(e);return r(e,[{key:"pinchStartEvent",value(){this._pinchScale=1,this._touchZoomed=!0}},{key:"pinchEvent",value(t,e){const i=5*(e-this._pinchScale);this._pinchScale=e,this._chartData.zoom(i,t)}},{key:"mouseLeaveEvent",value(t){nt(t)&&this._chartData.setCrosshair()}},{key:"mouseMoveEvent",value(t){const e=this;nt(t)&&this._performCross(t,!1,i=>{e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId})},()=>{e._chartData.setCrosshair()})}},{key:"mouseWheelEvent",value(t){if(this._checkEventPointX(t.localX))if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(t.cancelable&&t.preventDefault(),0===Math.abs(t.deltaX))return;this._chartData.startScroll(),this._chartData.scroll(-t.deltaX)}else{let e=-t.deltaY/100;if(0===e)return;switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}
if(0!==e){const i=Math.sign(e)*Math.min(1,Math.abs(e));this._chartData.zoom(i,{x:t.localX,y:t.localY})}}}},{key:"mouseClickEvent",value(t){const e=this;this._performCross(t,!0,i=>{e._touchPoint||e._touchCancelCrossHair||e._touchZoomed||(e._touchPoint={x:t.localX,y:t.localY},e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId}))})}},{key:"mouseDownEvent",value(t){const e=this;this._startScrollPoint={x:t.localX,y:t.localY},this._chartData.startScroll(),this._performCross(t,!0,i=>{if(e._touchZoomed=!1,e._touchPoint){const a=t.localX-e._touchPoint.x,s=t.localY-e._touchPoint.y;Math.sqrt(a*a+s*s)<10?(e._touchPoint={x:t.localX,y:t.localY},e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId})):(e._touchCancelCrossHair=!0,e._touchPoint=null,e._chartData.setCrosshair())}else e._touchCancelCrossHair=!1})}},{key:"pressedMouseMoveEvent",value(t){const e=this;this._performCross(t,!1,i=>{let a={x:t.localX,y:i.y,paneId:i.paneId};if(st(t)){if(e._touchPoint)return e._touchPoint={x:t.localX,y:t.localY},void e._chartData.setCrosshair(a);a=null}e._chartData.scroll(t.localX-e._startScrollPoint.x,a)})}},{key:"longTapEvent",value(t){const e=this;this._performCross(t,!0,i=>{e._touchPoint={x:t.localX,y:t.localY},e._chartData.setCrosshair({x:t.localX,y:i.y,paneId:i.paneId})})}},{key:"_performCross",value(t,e,i,a){if(!e||st(t))if(this._checkEventPointX(t.localX)){let e=!1;for(const a in this._paneContentSize){const s=this._paneContentSize[a];if(t.localY>s.contentTop&&s.contentBottom>t.localY){e=!0,i&&i({paneId:a,y:t.localY-s.contentTop});break}}!e&&a&&a()}else a&&a()}}]),e}($e),Qe=function(t){function e(t){let a;return n(this,e),(a=i.call(this,t))._pressedGraphicMark=null,a}h(e,t);const i=_(e);return r(e,[{key:"_performOverlayMouseHover",value(t,e,i,a){let s,n;const o=m(t);try{for(o.s();!(n=o.n()).done&&!(s=n.value.checkMousePointOnGraphic(i)););}catch(t){o.e(t)}finally{o.f()}return s&&e.id===s.id||(e.id&&e.instance&&nt(a)&&e.instance.onMouseLeave({id:e.id,points:e.instance.points(),event:a}),s&&s.id!==e.id&&s.instance&&nt(a)&&s.instance.onMouseEnter({id:s.id,points:s.instance.points(),event:a})),s}},{key:"mouseUpEvent",value(t){this._pressedGraphicMark&&(this._pressedGraphicMark=null,this._chartData.setDragGraphicMarkFlag(!1))}},{key:"mouseMoveEvent",value(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)&&!this._waitingForMouseMoveAnimationFrame){let e,i,a;this._waitingForMouseMoveAnimationFrame=!0;const s={x:t.localX,y:t.localY},n=this._chartData.graphicMarks(),o=this._chartData.visibleAnnotations(),r=n[n.length-1],c=this._chartData.graphicMarkMouseOperate().hover,h=this._chartData.annotationMouseOperate();r&&r.isDrawing()?(r.mouseMoveForDrawing(s),e=r.checkMousePointOnGraphic(s),i={id:"",element:te,elementIndex:-1}):(e=this._performOverlayMouseHover(n,c,s,t),a=this._performOverlayMouseHover(o,h,s,t)),this._chartData.setOverlayMouseOperate({hover:e||{id:"",element:te,elementIndex:-1},click:i},a||{id:""}),this._waitingForMouseMoveAnimationFrame=!1}}},{key:"mouseDownEvent",value(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)){let e;const i={x:t.localX,y:t.localY},s=this._chartData.graphicMarks(),n=s[s.length-1];let o={id:"",element:te,elementIndex:-1};if(n&&n.isDrawing())n.mouseLeftButtonDownForDrawing(i),e=n.checkMousePointOnGraphic(i);else{let n;const r=m(s);try{for(r.s();!(n=r.n()).done;){const s=n.value;if(e=s.checkMousePointOnGraphic(i)){e.element===Qt&&(this._pressedGraphicMark=s,this._chartData.setDragGraphicMarkFlag(!0),o=a({},e)),s.onClick({id:e.id,points:s.points(),event:t});break}}}catch(t){r.e(t)}finally{r.f()}let c;const h=m(this._chartData.visibleAnnotations());try{for(h.s();!(c=h.n()).done;){const e=c.value,a=e.checkMousePointOnGraphic(i);if(a){e.onClick({id:a.id,points:e.points(),event:t});break}}}catch(t){h.e(t)}finally{h.f()}}this._chartData.setOverlayMouseOperate({hover:o,click:e||{id:"",element:te,elementIndex:-1}})}}},{key:"mouseRightDownEvent",value(t){const e=this._chartData.graphicMarks().find(e=>e.checkMousePointOnGraphic({x:t.localX,y:t.localY}));e&&!e.onRightClick({id:e.id(),points:e.points(),event:t})&&this._chartData.removeGraphicMarkInstance(e.id());const i=this._chartData.visibleAnnotations().find(e=>e.checkMousePointOnGraphic({x:t.localX,y:t.localY}));i&&i.onRightClick({id:i.id(),points:i.points(),event:t})}},{key:"pressedMouseMoveEvent",value(t){const e=this._chartData.graphicMarks(),i=e[e.length-1];i&&i.isDrawing()||!this._pressedGraphicMark||(this._pressedGraphicMark.mousePressedMove({x:t.localX,y:t.localY},t),this._chartData.invalidate(ve))}},{key:"_checkEventPointY",value(t){const e=this._paneContentSize.candle_pane;return t>e.contentTop&&e.contentBottom>t}}]),e}($e),ti="Equal",ei="Minus",ii="ArrowLeft",ai="ArrowRight",si=function(t){function e(){return n(this,e),i.apply(this,arguments)}h(e,t);const i=_(e);return r(e,[{key:"keyBoardDownEvent",value(t){if(t.shiftKey)switch(t.code){case ti:this._chartData.zoom(.5);break;case ei:this._chartData.zoom(-.5);break;case ii:this._chartData.startScroll(),this._chartData.scroll(-3*this._chartData.dataSpace());break;case ai:this._chartData.startScroll(),this._chartData.scroll(3*this._chartData.dataSpace())}}}]),e}($e),ni=function(){function t(e,i){n(this,t),this._target=e,this._chartData=i,this._chartContentSize={},this._event=new Ke(this._target,{pinchStartEvent:this._pinchStartEvent.bind(this),pinchEvent:this._pinchEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseClickEvent:this._mouseClickEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),mouseRightDownEvent:this._mouseRightDownEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),mouseWheelEvent:this._mouseWheelEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1}),this._boundKeyBoardDownEvent=this._keyBoardDownEvent.bind(this),this._target.addEventListener("keydown",this._boundKeyBoardDownEvent),this._boundContextMenuEvent=function(t){t.preventDefault()},this._target.addEventListener("contextmenu",this._boundContextMenuEvent,!1),this._zoomScrollEventHandler=new Je(i),this._overlayEventHandler=new Qe(i),this._keyBoardEventHandler=new si(i)}return r(t,[{key:"_keyBoardDownEvent",value(t){this._keyBoardEventHandler.keyBoardDownEvent(t)}},{key:"_pinchStartEvent",value(){this._zoomScrollEventHandler.pinchStartEvent()}},{key:"_pinchEvent",value(t,e){this._zoomScrollEventHandler.pinchEvent(t,e)}},{key:"_mouseUpEvent",value(t){this._target.style.cursor="crosshair",this._shouldPerformOverlayEvent()&&(t.localX-=this._chartContentSize.contentLeft,this._overlayEventHandler.mouseUpEvent(t))}},{key:"_mouseLeaveEvent",value(t){this._checkZoomScroll()&&(t.localX-=this._chartContentSize.contentLeft,this._zoomScrollEventHandler.mouseLeaveEvent(t))}},{key:"_mouseMoveEvent",value(t){t.localX-=this._chartContentSize.contentLeft,this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseMoveEvent(t),this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseMoveEvent(t)}},{key:"_mouseWheelEvent",value(t){this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseWheelEvent(t)}},{key:"_mouseClickEvent",value(t){this._checkZoomScroll()&&(t.localX-=this._chartContentSize.contentLeft,this._zoomScrollEventHandler.mouseClickEvent(t))}},{key:"_mouseDownEvent",value(t){this._target.style.cursor="pointer",t.localX-=this._chartContentSize.contentLeft,this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseDownEvent(t),this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseDownEvent(t)}},{key:"_mouseRightDownEvent",value(t){this._shouldPerformOverlayEvent()&&(t.localX-=this._chartContentSize.contentLeft,this._overlayEventHandler.mouseRightDownEvent(t))}},{key:"_pressedMouseMoveEvent",value(t){t.localX-=this._chartContentSize.contentLeft,this._chartData.dragGraphicMarkFlag()&&(this._overlayEventHandler.pressedMouseMoveEvent(t),this._chartData.crosshair().paneId&&this._chartData.setCrosshair()),this._checkZoomScroll()&&this._zoomScrollEventHandler.pressedMouseMoveEvent(t)}},{key:"_longTapEvent",value(t){this._checkZoomScroll()&&(t.localX-=this._chartContentSize.contentLeft,this._zoomScrollEventHandler.longTapEvent(t))}},{key:"_checkZoomScroll",value(){const t=this._chartData.graphicMarks(),e=t.length;return!(this._chartData.dragPaneFlag()||this._chartData.dragGraphicMarkFlag()||0!==e&&t[e-1].isDrawing())}},{key:"_shouldPerformOverlayEvent",value(){return this._chartData.graphicMarks().length>0||this._chartData.visibleAnnotations().length>0}},{key:"setChartContentSize",value(t){this._chartContentSize=t,this._zoomScrollEventHandler.setChartContentSize(t),this._overlayEventHandler.setChartContentSize(t)}},{key:"setPaneContentSize",value(t){this._zoomScrollEventHandler.setPaneContentSize(t),this._overlayEventHandler.setPaneContentSize(t)}},{key:"destroy",value(){this._event.destroy(),this._target.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._target.removeEventListener("contextmenu",this._boundContextMenuEvent)}}]),t}(),oi=function(t){function e(t){let a;const s=t.id,o=t.point,r=t.chartData,c=t.xAxis,h=t.yAxis,l=t.styles;return n(this,e),(a=i.call(this,{id:s,chartData:r,xAxis:c,yAxis:h}))._point=o,a._symbolCoordinate={},a.setStyles(l,r.styleOptions().annotation),a}h(e,t);const i=_(e);return r(e,[{key:"_drawSymbol",value(t,e,i){const a=this._chartData.barSpace(),s=i.symbol,n=s.size,o=s.activeSize,r=e?D(o)?o:a:D(n)?n:a,c=e?s.activeColor:s.color;switch(s.type){case Ft:z(t,c,this._symbolCoordinate,r/2);break;case zt:!function(t,e,i,a,s,n){t.fillStyle=e,t.fillRect(i,a,s,n)}(t,c,this._symbolCoordinate.x-r/2,this._symbolCoordinate.y-r/2,r,r);break;case Vt:!function(t,e,i,a,s){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-a/2,i.y),t.lineTo(i.x,i.y-s/2),t.lineTo(i.x+a/2,i.y),t.lineTo(i.x,i.y+s/2),t.closePath(),t.fill()}(t,c,this._symbolCoordinate,r,r);break;case Bt:!function(t,e,i,a,s){t.fillStyle=e,t.beginPath(),t.moveTo(i.x-a/2,i.y+s/2),t.lineTo(i.x,i.y-s/2),t.lineTo(i.x+a/2,i.y+s/2),t.closePath(),t.fill()}(t,c,this._symbolCoordinate,r,r);break;case Ht:this.drawCustomSymbol({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height(),barSpace:a},styles:s,isActive:e})}}},{key:"draw",value(t){const e=this._styles||this._chartData.styleOptions().annotation,i=e.symbol,a=i.offset||[];let s=0;switch(i.position){case Yt:s=this._yAxis.convertToPixel(this._point.price);break;case Wt:s=0;break;case Nt:s=this._yAxis.height()}this._symbolCoordinate.y=s+(a[1]||0);const n=this._id===this._chartData.annotationMouseOperate().id;this._drawSymbol(t,n,e),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},styles:e,isActive:n}),t.restore())}},{key:"checkMousePointOnGraphic",value(t){let e,i,a,s;const n=this._chartData.barSpace(),o=(this._styles||this._chartData.styleOptions().annotation).symbol,r=D(o.size)?o.size:n;switch(o.type){case Ft:e=V(this._symbolCoordinate,r/2,t);break;case zt:a={x:this._symbolCoordinate.x+r/2,y:this._symbolCoordinate.y+r/2},e=!((i={x:this._symbolCoordinate.x-r/2,y:this._symbolCoordinate.y-r/2}).x>(s=t).x||s.x>a.x||i.y>s.y||s.y>a.y);break;case Vt:e=function(t,e,i,a){return e*i/2+2>Math.abs(t.x-a.x)*i+Math.abs(t.y-a.y)*e}(this._symbolCoordinate,r,r,t);break;case Bt:e=function(t,e){const i=B(t[0],t[1],t[2]),a=B(t[0],t[1],e)+B(t[0],t[2],e)+B(t[1],t[2],e);return Math.abs(i-a)<2}([{x:this._symbolCoordinate.x-r/2,y:this._symbolCoordinate.y+r/2},{x:this._symbolCoordinate.x,y:this._symbolCoordinate.y-r/2},{x:this._symbolCoordinate.x+r/2,y:this._symbolCoordinate.y+r/2}],t);break;case Ht:e=this.checkPointInCustomSymbol({mouseCoordinate:t,coordinate:this._symbolCoordinate,size:r})}if(e)return{id:this._id,instance:this}}},{key:"createSymbolCoordinate",value(t){const e=this._styles||this._chartData.styleOptions().annotation;this._symbolCoordinate={x:t+((e.symbol.offset||[])[0]||0)}}},{key:"points",value(){return this._point}},{key:"checkPointInCustomSymbol",value(t){}},{key:"drawCustomSymbol",value(t){}}]),e}($t),ri=function(t){function e(t){let a;const s=t.id,o=t.point,r=t.text,c=t.mark,h=t.chartData,l=t.xAxis,d=t.yAxis,u=t.styles;return n(this,e),(a=i.call(this,{id:s,chartData:h,xAxis:l,yAxis:d}))._point=o||{},a._text=r,a._mark=c,a.setStyles(u,h.styleOptions().tag),a}h(e,t);const i=_(e);return r(e,[{key:"update",value(t){const e=t.point,i=t.text,a=t.mark,s=t.styles;let n=!1;return k(e)&&(this._point=e,n=!0),w(i)&&(this._text=i,n=!0),w(a)&&(this._mark=a,n=!0),this.setStyles(s,this._chartData.styleOptions().tag)&&(n=!0),n}},{key:"drawMarkLine",value(t){const e=this._chartData.styleOptions(),i=e.yAxis,a=this._styles||e.tag,s=this._getY(a);t.save(),this._drawLine(t,s,a.line),this._drawMark(t,s,a,i),t.restore()}},{key:"drawText",value(t){if(w(this._text)){const e=this._chartData.styleOptions(),i=this._styles||e.tag,a=i.text;let s;t.font=Z(a.size,a.weight,a.family);const n=this._getTextRectWidth(t,a),o=a.paddingTop+a.paddingBottom+a.size;s=this._yAxis.isFromYAxisZero()?0:this._yAxis.width()-n;const r=this._getY(i);J(t,a.backgroundColor,s,r-o/2,n,o,a.borderRadius),K(t,a.color,s+a.paddingLeft,r,this._text)}}},{key:"_drawLine",value(t,e,i){i.show&&(t.strokeStyle=i.color,t.lineWidth=i.size,i.style===ft&&t.setLineDash(i.dashValue),H(t,e,0,this._xAxis.width()))}},{key:"_drawMark",value(t,e,i,a){if(w(this._mark)){const s=i.mark;let n;t.font=Z(s.size,s.weight,s.family);const o=s.paddingLeft+s.paddingRight+j(t,this._mark),r=s.paddingTop+s.paddingBottom+s.size;if(a.inside){let e=0;w(this._text)&&(e=this._getTextRectWidth(t,i.text)),n=a.position===kt?e:this._xAxis.width()-e-o}else n=a.position===kt?0:this._xAxis.width()-o;J(t,s.backgroundColor,n,e-r/2,o,r,s.borderRadius),t.textBaseline="middle",t.font=Z(s.size,s.weight,s.family),K(t,s.color,n+s.paddingLeft,e,this._mark)}}},{key:"_getY",value(t){const e=t.offset;switch(t.position){case Wt:return e;case Nt:return this._yAxis.height()+e;default:return this._yAxis.convertToNicePixel(this._point.price)+e}}},{key:"_getTextRectWidth",value(t,e){return t.font=Z(e.size,e.weight,e.family),e.paddingLeft+e.paddingRight+j(t,this._text)}}]),e}($t),ci=function(){function t(e,i){n(this,t),this._initChartContainer(e),this._graphicMarkBaseId=0,this._paneBaseId=0,this._separatorDragStartTopPaneHeight=0,this._separatorDragStartBottomPaneHeight=0,this._chartData=new ke(i,{invalidate:this._invalidatePane.bind(this),crosshair:this._crosshairObserver.bind(this)}),this._xAxisPane=new We({container:this._chartContainer,chartData:this._chartData}),this._panes=new Map([[me,new ze({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),id:me})]]),this._separators=new Map,this._chartWidth={},this._chartHeight={},this._chartEvent=new ni(this._chartContainer,this._chartData),this.adjustPaneViewport(!0,!0,!0)}return r(t,[{key:"_initChartContainer",value(t){this._container=t,this._chartContainer=document.createElement("div"),this._chartContainer.style.userSelect="none",this._chartContainer.style.webkitUserSelect="none",this._chartContainer.style.msUserSelect="none",this._chartContainer.style.MozUserSelect="none",this._chartContainer.style.webkitTapHighlightColor="transparent",this._chartContainer.style.position="relative",this._chartContainer.style.outline="none",this._chartContainer.style.borderStyle="none",this._chartContainer.style.width="100%",this._chartContainer.style.cursor="crosshair",this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}},{key:"_crosshairObserver",value(t){const e=t.dataIndex,i=t.kLineData,a=t.x,s=t.y;if(this.chartData().hasAction(fe.CROSSHAIR)){const t={};this._panes.forEach((i,a)=>{const s={};i.technicalIndicators().forEach(t=>{s[t.name]=t.result[e]}),t[a]=s}),this._chartData.actionExecute(fe.CROSSHAIR,{coordinate:{x:a,y:s},dataIndex:e,kLineData:i,technicalIndicatorData:t})}}},{key:"_separatorStartDrag",value(t,e){this._separatorDragStartTopPaneHeight=this._panes.get(t).height(),this._separatorDragStartBottomPaneHeight=this._panes.get(e).height()}},{key:"_separatorDrag",value(t,e,i){let a=this._separatorDragStartTopPaneHeight+t,s=this._separatorDragStartBottomPaneHeight-t;a>this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight&&(a=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight,s=0),a<0&&(a=0,s=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight),this._panes.get(e).setHeight(a),this._panes.get(i).setHeight(s),this._chartData.actionExecute(fe.PANE_DRAG,{topPaneId:e,bottomPaneId:i,topPaneHeight:a,bottomPaneHeight:s}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"_invalidatePane",value(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge;if(t===ve)this._xAxisPane.invalidate(t),this._panes.forEach(e=>{e.invalidate(t)});else{let t=!1;this._panes.forEach(e=>{const i=e.yAxis().computeAxis();i&&(t=i)}),this.adjustPaneViewport(!1,t,!0)}}},{key:"_calcAllPaneTechnicalIndicator",value(){const t=this,e=[];this._panes.forEach(t=>{e.push(Promise.resolve(t.calcAllTechnicalIndicator()))}),Promise.all(e).then(e=>{const i=e.indexOf(!0)>-1;t.adjustPaneViewport(!1,i,!0)})}},{key:"_measurePaneHeight",value(){const t=this,e=this._chartData.styleOptions(),i=this._container.offsetHeight,a=e.separator.size,s=a*this._separators.size,n=this._xAxisPane.xAxis().getSelfHeight(),o=i-n-s;let r=0;this._panes.forEach(t=>{if(t.id()!==me){const e=t.height();r+e>o?(t.setHeight(o-r),r=o):r+=e}});const c=o-r,h={};h.candle_pane={contentTop:0,contentBottom:c};let l=c,d=c;this._panes.get(me).setHeight(c),this._chartHeight.candle_pane=c,this._panes.forEach(e=>{if(e.id()!==me){const i=e.height();d+=i+a,h[e.id()]={contentTop:l,contentBottom:d},t._chartHeight[e.id()]=i,l=d}}),this._xAxisPane.setHeight(n),this._chartHeight.xAxis=n,this._chartHeight.total=i,this._chartEvent.setPaneContentSize(h)}},{key:"_measurePaneWidth",value(){let t,e,i;const a=this,s=this._chartData.styleOptions().yAxis,n=s.position===kt,o=this._container.offsetWidth;let r=Number.MIN_SAFE_INTEGER;s.inside?(t=o,r=o,e=0,i=0):(this._panes.forEach(t=>{r=Math.max(r,t.yAxis().getSelfWidth())}),t=o-r,n?(e=0,i=r):(i=0,e=o-r)),this._chartData.setTotalDataSpace(t),this._panes.forEach((s,n)=>{s.setWidth(t,r),s.setOffsetLeft(i,e);const o=a._separators.get(n);o&&o.setSize(i,t)}),this._chartWidth={content:t,yAxis:r,total:o},this._xAxisPane.setWidth(t,r),this._xAxisPane.setOffsetLeft(i,e),this._chartEvent.setChartContentSize({contentLeft:i,contentRight:i+t})}},{key:"adjustPaneViewport",value(t,e,i,a,s){t&&this._measurePaneHeight();let n=!1;a&&this._panes.forEach(t=>{const e=t.yAxis().computeAxis(s);n||(n=e)}),(!a&&e||a&&n)&&this._measurePaneWidth(),i&&(this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.layout(),this._panes.forEach(t=>{t.layout()}))}},{key:"chartData",value(){return this._chartData}},{key:"overrideTechnicalIndicator",value(t,e){const i=this,a=e.name,s=e.calcParams,n=e.precision,o=e.styles;t.setCalcParamsAllowDecimal(e.calcParamsAllowDecimal);const r=t.setCalcParams(s),c=t.setPrecision(n),h=this._chartData.styleOptions().technicalIndicator,l=t.setStyles(o,h);if(r||c||l){let t=!1;const e=[];this._panes.forEach(i=>{const s=i.technicalIndicators();if(s.has(a)){t=!0;const n=s.get(a);r&&e.push(Promise.resolve(i.calcTechnicalIndicator(n)))}}),t&&Promise.all(e).then(t=>{i.adjustPaneViewport(!1,!0,!0,!0)})}}},{key:"_applyDataList",value(t,e,i){g(t)&&(f(i)&&i(),this._chartData.addData(t,0,e),this._calcAllPaneTechnicalIndicator())}},{key:"applyNewData",value(t,e){const i=this;this._applyDataList(t,e,()=>{i._chartData.clearDataList()})}},{key:"applyMoreData",value(t,e){this._applyDataList(t,e)}},{key:"updateData",value(t){const e=this._chartData.dataList(),i=e.length,a=E(t,"timestamp",0),s=E(e[i-1],"timestamp",0);if(a>=s){let e=i;a===s&&(e=i-1),this._chartData.addData(t,e),this._calcAllPaneTechnicalIndicator()}}},{key:"removeTechnicalIndicator",value(t,e){const i=this;if(this._panes.has(t))if(t===me)this._panes.get(me).removeTechnicalIndicator(e)&&this.adjustPaneViewport(!1,!0,!0,!0);else{const a=this._panes.get(t),s=a.removeTechnicalIndicator(e);if(a.isEmptyTechnicalIndicator()){a.destroy();const e=this._separators.get(t).topPaneId();this._separators.get(t).destroy(),this._panes.delete(t),this._separators.delete(t),this._separators.forEach(t=>{const a=t.topPaneId();i._separators.has(a)||t.updatePaneId(e)}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}else s&&this.adjustPaneViewport(!1,!0,!0,!0)}}},{key:"createTechnicalIndicator",value(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._panes.has(i.id))return this.setPaneOptions(i,this._panes.get(i.id).setTechnicalIndicator(t,e)),i.id;const a=i.id||"".concat(pe).concat(++this._paneBaseId),s=!b(i.dragEnabled)||i.dragEnabled;return this._separators.set(a,new qe(this._chartContainer,this._chartData,Array.from(this._panes.keys()).pop(),a,s,{startDrag:this._separatorStartDrag.bind(this),drag:ot(this._separatorDrag.bind(this),50)})),this._panes.set(a,new Le({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),name:t.name,id:a,height:i.height||100})),this.adjustPaneViewport(!0,!0,!0,!0,!0),a}},{key:"getPaneTechnicalIndicator",value(t){const e=function(t){const e={};return t.technicalIndicators().forEach(t=>{e[t.name]=R(t)}),e};if(!w(t)){const t={};return this._panes.forEach(i=>{t[i.id()]=e(i)}),t}return this._panes.has(t)?e(this._panes.get(t)):{}}},{key:"createGraphicMark",value(t){const e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.id,a=e.points,s=e.styles,n=e.lock,o=e.onDrawStart,r=e.onDrawing,c=e.onDrawEnd,h=e.onClick,l=e.onRightClick,d=e.onPressedMove,u=e.onMouseEnter,_=e.onMouseLeave,p=e.onRemove,y=i||"".concat(ye).concat(++this._graphicMarkBaseId),m=new t({id:y,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),yAxis:this._panes.get(me).yAxis(),points:a,styles:s,lock:n});if(f(o)&&(m.onDrawStart=o,m.onDrawStart({id:y})),f(r)&&(m.onDrawing=r),f(c)&&(m.onDrawEnd=c),f(h)&&(m.onClick=h),f(l)&&(m.onRightClick=l),f(d)&&(m.onPressedMove=d),f(u)&&(m.onMouseEnter=u),f(_)&&(m.onMouseLeave=_),f(p)&&(m.onRemove=p),this._chartData.addGraphicMarkInstance(m))return y}},{key:"createAnnotation",value(t){const e=this,i=[];t.forEach(t=>{const a=t.point,s=t.styles,n=t.checkPointInCustomSymbol,o=t.drawCustomSymbol,r=t.drawExtend,c=t.onClick,h=t.onRightClick,l=t.onMouseEnter,d=t.onMouseLeave;if(a&&a.timestamp){const t=new oi({id:a.timestamp,chartData:e._chartData,point:a,xAxis:e._xAxisPane.xAxis(),yAxis:e._panes.get(me).yAxis(),styles:s});f(r)&&(t.drawExtend=r),f(n)&&(t.checkPointInCustomSymbol=n),f(o)&&(t.drawCustomSymbol=o),f(c)&&(t.onClick=c),f(h)&&(t.onRightClick=h),f(l)&&(t.onMouseEnter=l),f(d)&&(t.onMouseLeave=d),i.push(t)}}),i.length>0&&this._chartData.addAnnotations(i)}},{key:"createTag",value(t){const e=this,i=[];let a=!1,s=!1;t.forEach(t=>{const n=t.id,o=t.point,r=t.text,c=t.mark,h=t.styles;if(w(n)){const t=e._chartData.getTag(n);if(t){const e=t.update({point:o,text:r,mark:c,styles:h});a||(a=e)}else s=!0,i.push(new ri({id:n,point:o,text:r,mark:c,styles:h,chartData:e._chartData,xAxis:e._xAxisPane.xAxis(),yAxis:e._panes.get(me).yAxis()}))}}),s?this._chartData.addTags(i):a&&this._invalidatePane(ve)}},{key:"setPaneOptions",value(t,e){let i=e,a=!1;if(t.id!==me){const e=this._panes.get(t.id);e&&(D(t.height)&&t.height>0&&e.height()!==t.height&&(i=!0,e.setHeight(t.height),a=!0),b(t.dragEnabled)&&this._separators.get(t.id).setDragEnabled(t.dragEnabled))}i&&this.adjustPaneViewport(a,!0,!0,!0)}},{key:"setTimezone",value(t){this._chartData.setTimezone(t),this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.invalidate(ge)}},{key:"convertToPixel",value(t,e){let i;const a=this,s=e.paneId,n=void 0===s?me:s,o=e.dataIndexXAxis,r=e.absoluteYAxis,c=[].concat(t);let h=[];const l=this._chartData.styleOptions().separator.size;let d=0;const u=m(this._panes.values());try{const e=function(){const t=i.value;if(t.id()===n)return h=c.map(e=>{const i=e.xAxisValue,s=e.yAxisValue,n={};if(w(i)){const t=o?i:a._chartData.timestampToDataIndex(i);n.x=a._xAxisPane.xAxis().convertToPixel(t)}if(w(s)){const e=t.yAxis().convertToPixel(s);n.y=r?d+e:e}return n}),"break";d+=t.height()+l};for(u.s();!(i=u.n()).done&&"break"!==e(););}catch(t){u.e(t)}finally{u.f()}return g(t)?h:h[0]||{}}},{key:"convertFromPixel",value(t,e){let i;const a=this,s=e.paneId,n=void 0===s?me:s,o=e.dataIndexXAxis,r=e.absoluteYAxis,c=[].concat(t);let h=[];const l=this._chartData.styleOptions().separator.size;let d=0;const u=m(this._panes.values());try{const e=function(){const t=i.value;if(t.id()===n)return h=c.map(e=>{const i=e.x,s=e.y,n={};if(w(i)){const t=a._xAxisPane.xAxis().convertFromPixel(i);n.xAxisValue=o?t:a._chartData.dataIndexToTimestamp(t)}if(w(s)){const e=r?s-d:s;n.yAxisValue=t.yAxis().convertFromPixel(e)}return n}),"break";d+=t.height()+l};for(u.s();!(i=u.n()).done&&"break"!==e(););}catch(t){u.e(t)}finally{u.f()}return g(t)?h:h[0]||{}}},{key:"chartWidth",value(){return this._chartWidth}},{key:"chartHeight",value(){return this._chartHeight}},{key:"getConvertPictureUrl",value(t,e,i){const a=this,s=document.createElement("canvas"),n=s.getContext("2d"),o=G(s),r=this._chartContainer.offsetWidth,c=this._chartContainer.offsetHeight;s.style.width="".concat(r,"px"),s.style.height="".concat(c,"px"),s.width=r*o,s.height=c*o,n.scale(o,o),n.fillStyle=i,n.fillRect(0,0,r,c);let h=0;return this._panes.forEach((e,i)=>{if(i!==me){const t=a._separators.get(i);n.drawImage(t.getImage(),0,h,r,t.height()),h+=t.height()}n.drawImage(e.getImage(t),0,h,r,e.height()),h+=e.height()}),n.drawImage(this._xAxisPane.getImage(t),0,h,r,this._xAxisPane.height()),s.toDataURL("image/".concat(e))}},{key:"destroy",value(){this._panes.forEach(t=>{t.destroy()}),this._separators.forEach(t=>{t.destroy()}),this._panes.clear(),this._separators.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer),this._chartEvent.destroy()}}]),t}(),hi=function(){function t(e,i){n(this,t),this._chartPane=new ci(e,i)}return r(t,[{key:"getWidth",value(){return this._chartPane.chartWidth()}},{key:"getHeight",value(){return this._chartPane.chartHeight()}},{key:"setStyleOptions",value(t){k(t)&&(this._chartPane.chartData().applyStyleOptions(t),this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0))}},{key:"getStyleOptions",value(){return x(this._chartPane.chartData().styleOptions())}},{key:"overrideTechnicalIndicator",value(t){if(k(t)){const e=this._chartPane.chartData().getTechnicalIndicatorInstance(t.name);e&&this._chartPane.overrideTechnicalIndicator(e,t)}}},{key:"getTechnicalIndicatorByName",value(t){return this._chartPane.chartData().getTechnicalIndicatorInfo(t)}},{key:"getTechnicalIndicatorByPaneId",value(t){return this._chartPane.getPaneTechnicalIndicator(t)}},{key:"setPriceVolumePrecision",value(t,e){D(t)&&t>=0&&D(e)&&e>=0&&this._chartPane.chartData().setPriceVolumePrecision(t,e)}},{key:"setTimezone",value(t){this._chartPane.setTimezone(t)}},{key:"getTimezone",value(){return this._chartPane.chartData().timezone()}},{key:"resize",value(){this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"setOffsetRightSpace",value(t){D(t)&&this._chartPane.chartData().setOffsetRightSpace(t,!0)}},{key:"setLeftMinVisibleBarCount",value(t){D(t)&&t>0&&this._chartPane.chartData().setLeftMinVisibleBarCount(Math.ceil(t))}},{key:"setRightMinVisibleBarCount",value(t){D(t)&&t>0&&this._chartPane.chartData().setRightMinVisibleBarCount(Math.ceil(t))}},{key:"setDataSpace",value(t){D(t)&&this._chartPane.chartData().setDataSpace(t)}},{key:"clearData",value(){this._chartPane.chartData().clearDataList()}},{key:"getDataList",value(){return this._chartPane.chartData().dataList()}},{key:"applyNewData",value(t,e){g(t)&&this._chartPane.applyNewData(t,e)}},{key:"applyMoreData",value(t,e){g(t)&&this._chartPane.applyMoreData(t,e)}},{key:"updateData",value(t){k(t)&&!g(t)&&this._chartPane.updateData(t)}},{key:"loadMore",value(t){f(t)&&this._chartPane.chartData().setLoadMoreCallback(t)}},{key:"createTechnicalIndicator",value(t,e,i){const a=this._chartPane.chartData().getTechnicalIndicatorInstance(t);return a?this._chartPane.createTechnicalIndicator(a,e,i):null}},{key:"addCustomTechnicalIndicator",value(t){if(k(t)){const e=[].concat(t);this._chartPane.chartData().addCustomTechnicalIndicator(e)}}},{key:"removeTechnicalIndicator",value(t,e){this._chartPane.removeTechnicalIndicator(t,e)}},{key:"createGraphicMark",value(t,e){const i=this._chartPane.chartData().graphicMarkMapping()[t];return i?this._chartPane.createGraphicMark(i,e):null}},{key:"getGraphicMark",value(t){return this._chartPane.chartData().getGraphicMark(t)}},{key:"setGraphicMarkOptions",value(t,e){this._chartPane.chartData().setGraphicMarkOptions(t,e)}},{key:"addCustomGraphicMark",value(t){if(k(t)){const e=[].concat(t);this._chartPane.chartData().addCustomGraphicMark(e)}}},{key:"removeGraphicMark",value(t){this._chartPane.chartData().removeGraphicMarkInstance(t)}},{key:"createAnnotation",value(t){if(k(t)){const e=[].concat(t);this._chartPane.createAnnotation(e)}}},{key:"removeAnnotation",value(t){this._chartPane.chartData().removeAnnotation(t)}},{key:"createTag",value(t){if(k(t)){const e=[].concat(t);this._chartPane.createTag(e)}}},{key:"removeTag",value(t){this._chartPane.chartData().removeTag(t)}},{key:"setPaneOptions",value(){const t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._chartPane.setPaneOptions(t,!1)}},{key:"setZoomEnabled",value(t){this._chartPane.chartData().setZoomEnabled(t)}},{key:"isZoomEnabled",value(){return this._chartPane.chartData().zoomEnabled()}},{key:"setScrollEnabled",value(t){this._chartPane.chartData().setScrollEnabled(t)}},{key:"isScrollEnabled",value(){return this._chartPane.chartData().scrollEnabled()}},{key:"scrollByDistance",value(t,e){const i=this;if(D(t))if(D(e)&&e>0){this._chartPane.chartData().startScroll();const a=(new Date).getTime();!function s(){const n=((new Date).getTime()-a)/e,o=n>=1,r=o?t:t*n;i._chartPane.chartData().scroll(r),o||U(s)}()}else this._chartPane.chartData().startScroll(),this._chartPane.chartData().scroll(t)}},{key:"scrollToRealTime",value(t){const e=(this._chartPane.chartData().offsetRightBarCount()-this._chartPane.chartData().offsetRightSpace()/this._chartPane.chartData().dataSpace())*this._chartPane.chartData().dataSpace();this.scrollByDistance(e,t)}},{key:"scrollToPosition",value(t,e){if(D(t)){const i=(this._chartPane.chartData().dataList().length-1-t)*this._chartPane.chartData().dataSpace();this.scrollByDistance(i,e)}}},{key:"zoomAtCoordinate",value(t,e,i){const a=this;if(D(t))if(D(i)&&i>0){const s=this._chartPane.chartData().dataSpace(),n=s*t-s,o=(new Date).getTime();!function t(){const r=((new Date).getTime()-o)/i,c=r>=1,h=c?n:n*r;a._chartPane.chartData().zoom(h/s,e),c||U(t)}()}else this._chartPane.chartData().zoom(t,e)}},{key:"zoomAtPosition",value(t,e,i){if(D(t)&&D(e)){const a=this._chartPane.chartData().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:a},i)}}},{key:"convertToPixel",value(t,e){return this._chartPane.convertToPixel(t,e)}},{key:"convertFromPixel",value(t,e){return this._chartPane.convertFromPixel(t,e)}},{key:"subscribeAction",value(t,e){this._chartPane.chartData().subscribeAction(t,e)}},{key:"unsubscribeAction",value(t,e){this._chartPane.chartData().unsubscribeAction(t,e)}},{key:"getConvertPictureUrl",value(t,e){const i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#FFFFFF";if("png"===i||"jpeg"===i||"bmp"===i)return this._chartPane.getConvertPictureUrl(t,i,a)}},{key:"destroy",value(){this._chartPane.destroy()}}]),t}(),li={};let di=1;const ui="k_line_chart_";gt.addTechnicalIndicator([{name:"AVP",series:"price",precision:2,plots:[{
key:"avp",title:"AVP: ",type:"line"}],calcTechnicalIndicator(t){let e=0,i=0;return t.map(t=>{const a={};return e+=t.turnover||0,0!==(i+=t.volume||0)&&(a.avp=e/i),a})}},rt,ct,ht,{name:"EMV",calcParams:[14,9],plots:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calcTechnicalIndicator(t,e){let i=0,a=0;const s=[],n=[];return t.forEach((o,r)=>{const c={},h=t[r-1]||o,l=o.high,d=o.low,u=o.turnover||0;let _=0;0!==u&&(_=((l+d)/2-(h.high+h.low)/2)*(l-d)/u),s.push(_),i+=_,e[0]-1>r||(c.emv=i,i-=s[r-(e[0]-1)],a+=c.emv,e[0]+e[1]-2>r||(c.maEmv=a/e[1],a-=n[r-(e[1]-1)].emv)),n.push(c)}),n}},{name:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldCheckParamCount:!1,shouldOhlc:!0,plots:[{key:"ema6",title:"EMA6: ",type:"line"},{key:"ema12",title:"EMA12: ",type:"line"},{key:"ema20",title:"EMA20: ",type:"line"}],regeneratePlots:t=>t.map(t=>({key:"ema".concat(t),title:"EMA".concat(t,": "),type:"line"})),calcTechnicalIndicator(t,e,i){let a=0;const s=[];return t.map((t,n)=>{const o={},r=t.close;return a+=r,e.forEach((t,e)=>{t-1>n||(s[e]=n>t-1?(2*r+(t-1)*s[e])/(t+1):a/t,o[i[e].key]=s[e])}),o})}},{name:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldCheckParamCount:!1,shouldOhlc:!0,plots:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regeneratePlots:t=>t.map(t=>({key:"ma".concat(t),title:"MA".concat(t,": "),type:"line"})),calcTechnicalIndicator(t,e,i){const a=[];return t.map((s,n)=>{const o={},r=s.close;return e.forEach((e,s)=>{a[s]=(a[s]||0)+r,e-1>n||(o[i[s].key]=a[s]/e,a[s]-=t[n-(e-1)].close)}),o})}},lt,{name:"SMA",calcParams:[12,2],series:"price",precision:2,plots:[{key:"sma",title:"SMA: ",type:"line"}],shouldCheckParamCount:!0,shouldOhlc:!0,calcTechnicalIndicator(t,e){let i=0,a=0;return t.map((t,s)=>{const n={},o=t.close;return i+=o,e[0]-1>s||(n.sma=a=s>e[0]-1?(o*e[1]+a*(e[0]-e[1]+1))/(e[0]+1):i/e[0]),n})}},{name:"TRIX",calcParams:[12,9],plots:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calcTechnicalIndicator(t,e){let i,a,s,n=0,o=0,r=0,c=0;const h=[];return t.forEach((t,l)=>{const d={},u=t.close;if(n+=u,l>=e[0]-1&&(o+=i=l>e[0]-1?(2*u+(e[0]-1)*i)/(e[0]+1):n/e[0],l>=2*e[0]-2&&(r+=a=l>2*e[0]-2?(2*i+(e[0]-1)*a)/(e[0]+1):o/e[0],l>=3*e[0]-3))){let t,i=0;l>3*e[0]-3?i=((t=(2*a+(e[0]-1)*s)/(e[0]+1))-s)/s*100:t=r/e[0],s=t,d.trix=i,c+=i,3*e[0]+e[1]-4>l||(d.maTrix=c/e[1],c-=h[l-(e[1]-1)].trix)}h.push(d)}),h}},{name:"BRAR",calcParams:[26],plots:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calcTechnicalIndicator(t,e){let i=0,a=0,s=0,n=0;return t.map((o,r)=>{const c={},h=o.high,l=o.low,d=o.open,u=(t[r-1]||o).close;if(s+=h-d,n+=d-l,i+=h-u,a+=u-l,r>=e[0]-1){c.ar=0!==n?s/n*100:0,c.br=0!==a?i/a*100:0;const o=t[r-(e[0]-1)],h=o.high,l=o.low,d=o.open,u=(t[r-e[0]]||t[r-(e[0]-1)]).close;i-=h-u,a-=u-l,s-=h-d,n-=d-l}return c})}},dt,{name:"MTM",calcParams:[12,6],plots:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calcTechnicalIndicator(t,e){let i=0;const a=[];return t.forEach((s,n)=>{const o={};n<e[0]||(o.mtm=s.close-t[n-e[0]].close,i+=o.mtm,e[0]+e[1]-1>n||(o.maMtm=i/e[1],i-=a[n-(e[1]-1)].mtm)),a.push(o)}),a}},{name:"PSY",calcParams:[12,6],plots:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calcTechnicalIndicator(t,e){let i=0,a=0;const s=[],n=[];return t.forEach((o,r)=>{const c={},h=o.close-(t[r-1]||o).close>0?1:0;s.push(h),i+=h,e[0]-1>r||(c.psy=i/e[0]*100,a+=c.psy,e[0]+e[1]-2>r||(c.maPsy=a/e[1],a-=n[r-(e[1]-1)].psy),i-=s[r-(e[0]-1)]),n.push(c)}),n}},{name:"ROC",calcParams:[12,6],shouldCheckParamCount:!0,plots:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calcTechnicalIndicator(t,e){const i=[];let a=0;return t.forEach((s,n)=>{const o={};if(n>=e[0]-1){const r=(t[n-e[0]]||t[n-(e[0]-1)]).close;o.roc=0!==r?(s.close-r)/r*100:0,a+=o.roc,e[0]-1+e[1]-1>n||(o.maRoc=a/e[1],a-=i[n-(e[1]-1)].roc)}i.push(o)}),i}},{name:"VR",calcParams:[26,6],plots:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calcTechnicalIndicator(t,e){let i=0,a=0,s=0,n=0;const o=[];return t.forEach((r,c)=>{const h={},l=r.close,d=(t[c-1]||r).close,u=r.volume;if(l>d?i+=u:d>l?a+=u:s+=u,c>=e[0]-1){const r=s/2;h.vr=a+r===0?0:(i+r)/(a+r)*100,n+=h.vr,e[0]+e[1]-2>c||(h.maVr=n/e[1],n-=o[c-(e[1]-1)].vr);const l=t[c-(e[0]-1)],d=t[c-e[0]]||l,u=l.close,_=l.volume;u>d.close?i-=_:d.close>u?a-=_:s-=_}o.push(h)}),o}},ut,{name:"BIAS",calcParams:[6,12,24],shouldCheckParamCount:!1,plots:[{key:"bias6",title:"BIAS6: ",type:"line"},{key:"bias12",title:"BIAS12: ",type:"line"},{key:"bias24",title:"BIAS24: ",type:"line"}],regeneratePlots:t=>t.map(t=>({key:"bias".concat(t),title:"BIAS".concat(t,": "),type:"line"})),calcTechnicalIndicator(t,e,i){const a=[];return t.map((s,n)=>{const o={},r=s.close;return e.forEach((s,c)=>{if(a[c]=(a[c]||0)+r,n>=s-1){const h=a[c]/e[c];o[i[c].key]=(r-h)/h*100,a[c]-=t[n-(s-1)].close}}),o})}},_t,pt,yt,mt,vt,xt,{name:"OBV",calcParams:[30],plots:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calcTechnicalIndicator(t,e){let i=0,a=0;const s=[];return t.forEach((n,o)=>{const r=t[o-1]||n;r.close>n.close?a-=n.volume:n.close>r.close&&(a+=n.volume);const c={obv:a};i+=a,e[0]-1>o||(c.maObv=i/e[0],i-=s[o-(e[0]-1)].obv),s.push(c)}),s}},{name:"PVT",plots:[{key:"pvt",title:"PVT: ",type:"line"}],calcTechnicalIndicator(t){let e=0;return t.map((i,a)=>{const s={},n=(t[a-1]||i).close;let o=0;return 0!==n&&(o=(i.close-n)/n*i.volume),s.pvt=e+=o,s})}},{name:"VOL",series:"volume",calcParams:[5,10,20],shouldCheckParamCount:!1,shouldFormatBigNumber:!0,precision:0,baseValue:0,minValue:0,plots:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma20",title:"MA20: ",type:"line"},{key:"volume",title:"VOLUME: ",type:"bar",color(t,e){const i=t.currentData.kLineData||{};return i.close>i.open?e.bar.upColor:i.open>i.close?e.bar.downColor:e.bar.noChangeColor}}],regeneratePlots(t){const e=t.map(t=>({key:"ma".concat(t),title:"MA".concat(t,": "),type:"line"}));return e.push({key:"volume",title:"VOLUME: ",type:"bar",color(t,e){const i=t.currentData.kLineData||{};return i.close>i.open?e.bar.upColor:i.open>i.close?e.bar.downColor:e.bar.noChangeColor}}),e},calcTechnicalIndicator(t,e,i){const a=[];return t.map((s,n)=>{const o=s.volume||0,r={volume:o};return e.forEach((e,s)=>{a[s]=(a[s]||0)+o,e-1>n||(r[i[s].key]=a[s]/e,a[s]-=t[n-(e-1)].volume)}),r})}}]),t.dispose=function(t){if(t){let e;if(P(t)){const i=document.getElementById(t);e=i&&i.chartId}else M(t)?e=t.chartId:t instanceof hi&&(e=t.id);e&&(li[e].destroy(),delete li[e])}},t.extension=gt,t.init=function(t){let e;const i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return null;if(!M(e=P(t)?document.getElementById(t):t))return null;let a=li[e.chartId||""];if(a)return a;const s="".concat(ui).concat(di++);return(a=new hi(e,i)).id=s,e.chartId=s,li[s]=a,a},t.version=function(){return"1.0.0"},Object.defineProperty(t,"__esModule",{value:!0})});
